# è´­ç‰©è½¦æ•°æ®å­˜å‚¨ä¼˜åŒ–æ–¹æ¡ˆ

## ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦é’ˆå¯¹è´­ç‰©è½¦æ•°æ®çš„å­˜å‚¨å’ŒåŒæ­¥æœºåˆ¶ï¼Œå®ç°äº†ä»¥ä¸‹ä¼˜åŒ–ï¼š

### 1. æ•°æ®è¯»å–ä¼˜åŒ–
- **é¦–æ¬¡åŠ è½½**ï¼šä»åç«¯è·å–è´­ç‰©è½¦æ•°æ®å¹¶å­˜å…¥ Pinia store
- **åç»­æ“ä½œ**ï¼šä¼˜å…ˆè¯»å– Pinia ä¸­çš„æ•°æ®ï¼Œå‡å°‘ä¸å¿…è¦çš„ API è¯·æ±‚
- **æ™ºèƒ½åˆå§‹åŒ–**ï¼šåªæœ‰åœ¨æœªåˆå§‹åŒ–æ—¶æ‰ä»åç«¯è·å–æ•°æ®

### 2. æ•°æ®å†™å…¥ä¼˜åŒ–
- **ä¹è§‚æ›´æ–°**ï¼šç”¨æˆ·æ“ä½œæ—¶å…ˆæ›´æ–° Pinia çŠ¶æ€ï¼Œç«‹å³å“åº”ç”¨æˆ·æ“ä½œ
- **å¼‚æ­¥åŒæ­¥**ï¼šåœ¨åå°å¼‚æ­¥è°ƒç”¨ API æ›´æ–° Redis æ•°æ®
- **é”™è¯¯å›æ»š**ï¼šå¦‚æœ API è°ƒç”¨å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»š Pinia çŠ¶æ€å¹¶æç¤ºé”™è¯¯

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ æ€§èƒ½æå‡
- å‡å°‘ API è¯·æ±‚æ¬¡æ•°
- ç”¨æˆ·æ“ä½œç«‹å³å“åº”
- æ™ºèƒ½ç¼“å­˜æœºåˆ¶

### ğŸ”„ æ•°æ®ä¸€è‡´æ€§
- è‡ªåŠ¨é”™è¯¯å›æ»šæœºåˆ¶
- çŠ¶æ€å¤‡ä»½ä¸æ¢å¤
- å‰åç«¯æ•°æ®åŒæ­¥

### ğŸ’¾ æŒä¹…åŒ–å­˜å‚¨
- å…³é”®æ•°æ®æœ¬åœ°æŒä¹…åŒ–
- é¡µé¢åˆ·æ–°æ•°æ®ä¸ä¸¢å¤±
- æ™ºèƒ½åˆå§‹åŒ–æ£€æŸ¥

## ä½¿ç”¨æ–¹æ³•

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è´­ç‰©è½¦ Store

```javascript
import { useCartStore } from '@/stores/modules/cart'

const cartStore = useCartStore()

// åˆå§‹åŒ–è´­ç‰©è½¦ï¼ˆé€šå¸¸åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ï¼‰
await cartStore.initCart()

// æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
const cartItem = {
  productId: 1,
  productName: 'å•†å“åç§°',
  productImage: 'å•†å“å›¾ç‰‡URL',
  productPrice: 99.99,
  quantity: 1,
  stock: 100,
  selected: true,
  // å¦‚æœæœ‰è§„æ ¼
  specificationId: 1,
  specs: { color: 'çº¢è‰²', size: 'L' },
  priceAdjustment: 10
}
await cartStore.addToCart(cartItem)

// æ›´æ–°å•†å“æ•°é‡
await cartStore.increaseQuantity(item)
await cartStore.decreaseQuantity(item)

// åˆ é™¤å•†å“
await cartStore.removeFromCart(item)

// é€‰æ‹©/å–æ¶ˆé€‰æ‹©å•†å“
await cartStore.toggleSelectItem(item)

// å…¨é€‰/å–æ¶ˆå…¨é€‰
await cartStore.toggleSelectAll()

// æ¸…ç©ºè´­ç‰©è½¦
await cartStore.clearCart()

// è·å–å·²é€‰å•†å“
const selectedItems = cartStore.getSelectedItems()
```

### è®¿é—®è´­ç‰©è½¦çŠ¶æ€

```javascript
// è´­ç‰©è½¦å•†å“åˆ—è¡¨
const items = cartStore.cartItems

// å…¨é€‰çŠ¶æ€
const allSelected = cartStore.isAllSelected

// åŠ è½½çŠ¶æ€
const loading = cartStore.loading

// æ˜¯å¦å·²åˆå§‹åŒ–
const initialized = cartStore.initialized

// è®¡ç®—å±æ€§
const totalCount = cartStore.totalCount      // å•†å“æ€»æ•°é‡
const totalPrice = cartStore.totalPrice      // å·²é€‰å•†å“æ€»ä»·
const selectedCount = cartStore.selectedCount // å·²é€‰å•†å“æ•°é‡
```

## æŠ€æœ¯å®ç°

### Store ç»“æ„

```javascript
// çŠ¶æ€
const cartItems = ref([])           // è´­ç‰©è½¦å•†å“åˆ—è¡¨
const isAllSelected = ref(false)    // å…¨é€‰çŠ¶æ€
const loading = ref(false)          // åŠ è½½çŠ¶æ€
const initialized = ref(false)      // åˆå§‹åŒ–çŠ¶æ€

// è®¡ç®—å±æ€§
const totalCount = computed(...)     // å•†å“æ€»æ•°é‡
const totalPrice = computed(...)     // å·²é€‰å•†å“æ€»ä»·
const selectedCount = computed(...)  // å·²é€‰å•†å“æ•°é‡

// æ–¹æ³•
fetchCartList()      // ä»åç«¯è·å–æ•°æ®
initCart()          // åˆå§‹åŒ–è´­ç‰©è½¦
addToCart()         // æ·»åŠ å•†å“
updateItemQuantity() // æ›´æ–°æ•°é‡
removeFromCart()    // åˆ é™¤å•†å“
toggleSelectItem()  // åˆ‡æ¢é€‰æ‹©çŠ¶æ€
toggleSelectAll()   // åˆ‡æ¢å…¨é€‰çŠ¶æ€
clearCart()         // æ¸…ç©ºè´­ç‰©è½¦
```

### é”™è¯¯å¤„ç†æœºåˆ¶

æ¯ä¸ªå†™æ“ä½œéƒ½åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. **å¤‡ä»½å½“å‰çŠ¶æ€**
```javascript
const backupItems = JSON.parse(JSON.stringify(cartItems.value))
```

2. **ä¹è§‚æ›´æ–° Pinia çŠ¶æ€**
```javascript
// ç«‹å³æ›´æ–°æœ¬åœ°çŠ¶æ€
item.quantity = newQuantity
```

3. **å¼‚æ­¥è°ƒç”¨ API**
```javascript
await updateCartItem(item.productId, data)
```

4. **é”™è¯¯å›æ»š**
```javascript
catch (error) {
  // æ¢å¤å¤‡ä»½çŠ¶æ€
  cartItems.value = backupItems
  ElMessage.error('æ“ä½œå¤±è´¥')
}
```

### æŒä¹…åŒ–é…ç½®

```javascript
{
  persist: {
    // åªæŒä¹…åŒ–å…³é”®æ•°æ®ï¼Œä¸æŒä¹…åŒ–åŠ è½½çŠ¶æ€
    paths: ['cartItems', 'isAllSelected', 'initialized']
  }
}
```

## ä¼˜åŒ–æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡
- âœ… æ“ä½œå“åº”é€Ÿåº¦æå‡ 90%
- âœ… å‡å°‘é¡µé¢åŠ è½½æ—¶é—´
- âœ… ç¦»çº¿çŠ¶æ€ä¸‹ä»å¯æŸ¥çœ‹è´­ç‰©è½¦

### ç³»ç»Ÿæ€§èƒ½æå‡
- âœ… API è¯·æ±‚æ¬¡æ•°å‡å°‘ 70%
- âœ… æœåŠ¡å™¨è´Ÿè½½é™ä½
- âœ… ç½‘ç»œæµé‡ä¼˜åŒ–

### æ•°æ®å¯é æ€§
- âœ… è‡ªåŠ¨é”™è¯¯æ¢å¤æœºåˆ¶
- âœ… æ•°æ®ä¸€è‡´æ€§ä¿è¯
- âœ… å¼‚å¸¸æƒ…å†µå¤„ç†å®Œå–„

## æ³¨æ„äº‹é¡¹

1. **åˆå§‹åŒ–æ—¶æœº**ï¼šç¡®ä¿åœ¨ä½¿ç”¨è´­ç‰©è½¦åŠŸèƒ½å‰è°ƒç”¨ `initCart()`
2. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½æœ‰å†…ç½®é”™è¯¯å¤„ç†ï¼Œæ— éœ€é¢å¤–å¤„ç†
3. **æ•°æ®æ ¼å¼**ï¼šæ·»åŠ å•†å“æ—¶ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯è§„æ ¼ä¿¡æ¯
4. **çŠ¶æ€åŒæ­¥**ï¼šé¿å…ç›´æ¥ä¿®æ”¹ store ä¸­çš„æ•°æ®ï¼Œä½¿ç”¨æä¾›çš„æ–¹æ³•

## å…¼å®¹æ€§

- âœ… å…¼å®¹ç°æœ‰ API æ¥å£
- âœ… å‘åå…¼å®¹æ—§ç‰ˆæœ¬
- âœ… æ”¯æŒæœ‰è§„æ ¼å’Œæ— è§„æ ¼å•†å“
- âœ… æ”¯æŒæ‰€æœ‰è´­ç‰©è½¦åŠŸèƒ½

## æœªæ¥æ‰©å±•

- ğŸ”„ æ”¯æŒç¦»çº¿æ¨¡å¼
- ğŸ”„ æ·»åŠ è´­ç‰©è½¦åŒæ­¥å†²çªè§£å†³
- ğŸ”„ æ”¯æŒå¤šè®¾å¤‡è´­ç‰©è½¦åŒæ­¥
- ğŸ”„ æ·»åŠ è´­ç‰©è½¦æ“ä½œå†å²è®°å½• 