import{r as V,K as le,L as ue,f as $,w as o,j as e,ab as de,ac as oe,Z as se,q as _,Q as R,Y as ne,P as q,b6 as ce,p as D,l as v,aA as Ie,aC as Ve,F as b,b7 as Se,ad as Ce,s as re,v as me,n as ee,av as ae,a5 as xe,ae as pe,a2 as fe,E as p,i as u,o as ge,M as ve,_ as ye,aw as Ee,as as _e,B as N,ar as be,c as we,b8 as Pe,U as $e,m as ze,a1 as Ue,a0 as je}from"./index-CZU4bJ5v.js";/* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                        *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                 */import{u as Oe,f as Ae,h as Me,i as De,c as ke,j as Be,k as Ke,l as Ne,m as Te,g as Fe,o as Le,n as Re,e as qe,p as Ge}from"./shop-Bqh9CrLv.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                       */const He={key:0,class:"tip-text"},Je={key:0,class:"spec-tip"},Qe={class:"upload-box"},Ye={key:0,class:"image-preview"},Ze=["src"],We={class:"preview-actions"},Xe={class:"sub-image-list"},et=["src"],tt={class:"preview-actions"},lt={class:"dialog-footer"},at={__name:"ProductDialog",props:{visible:{type:Boolean,default:!1},product:{type:Object,default:null},categories:{type:Array,default:()=>[]}},emits:["close","success"],setup(A,{emit:B}){const h=A,z=B,U=V(null),j=V(!1),r=le({name:"",subtitle:"",categoryId:"",price:0,stock:0,status:1,mainImage:"",subImages:"",detail:"",hasSpecification:0}),E=V(0);ue(()=>r.hasSpecification,i=>{i===1&&(E.value=r.stock)});const f=V([]);if(h.product&&(Object.keys(r).forEach(i=>{h.product[i]!==void 0&&(r[i]=h.product[i])}),E.value=h.product.stock||0,h.product.subImages)){const i=h.product.subImages;f.value=i.split(",").map(t=>t.trim()).filter(t=>t).map(t=>({url:t,name:t.substring(t.lastIndexOf("/")+1)})),console.log("初始化子图数组:",f.value)}const c=V(null),C=V([]),M=V(!1),G={name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:100,message:"长度在2到100个字符之间",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}],stock:[{required:!0,message:"请输入商品库存",trigger:"blur"},{type:"number",min:0,message:"库存不能为负数",trigger:"blur"}],mainImage:[{required:!0,message:"请上传商品主图",trigger:"change"}]};ue(()=>h.product,i=>{if(i)if(Object.keys(r).forEach(t=>{i[t]!==void 0&&(r[t]=i[t])}),i.subImages){const t=i.subImages;f.value=t.split(",").map(m=>m.trim()).filter(m=>m).map(m=>({url:m,name:m.substring(m.lastIndexOf("/")+1)})),r.subImages=f.value.map(m=>m.url).join(","),console.log("子图数组:",f.value)}else f.value=[];else H()});const H=()=>{Object.keys(r).forEach(i=>{i==="price"||i==="stock"?r[i]=0:i==="status"?r[i]=1:r[i]=""}),f.value=[],c.value=null,C.value=[]},J=i=>i.size/1024/1024<5?!0:(p.error("图片大小不能超过5MB!"),!1),Z=i=>{const t=i.target.files[0];if(t&&J(t)){c.value=t;const m=new FileReader;m.onload=s=>{r.mainImage=s.target.result},m.readAsDataURL(t)}},W=i=>{const t=i.target.files;if(!(!t||t.length===0)){if(f.value.length+t.length>5){p.warning("最多上传5张子图");return}for(let m=0;m<t.length;m++){const s=t[m];if(!J(s))continue;C.value.push(s);const l=new FileReader;l.onload=a=>{f.value.push({url:a.target.result,name:s.name,isTemp:!0})},l.readAsDataURL(s)}i.target.value=""}},X=async()=>{if(!c.value&&C.value.length===0)return Promise.resolve();M.value=!0;try{const i=new FormData;c.value&&i.append("mainImage",c.value),C.value.forEach(m=>{i.append("subImages",m)});const t=await Me(i);if(t.data.code===0){const m=JSON.parse(t.data.data);return m.mainImage&&(r.mainImage=m.mainImage),m.subImages&&m.subImages.length>0&&(f.value=f.value.filter(s=>!s.isTemp),m.subImages.forEach(s=>{f.value.push({url:s,name:s.substring(s.lastIndexOf("/")+1)})}),T()),p.success("图片上传成功"),Promise.resolve()}else return p.error(t.data.msg||"图片上传失败"),Promise.reject("图片上传失败")}catch(i){return console.error("上传图片出错",i),p.error("图片上传失败"),Promise.reject(i)}finally{M.value=!1,c.value=null,C.value=[]}},Q=i=>{f.value.splice(i,1),T()},T=()=>{const i=f.value.filter(t=>!t.isTemp&&t.url&&t.url.trim());r.subImages=i.map(t=>t.url.trim()).join(","),console.log("更新后的子图字符串:",r.subImages)},F=async()=>{var i;(i=U.value)==null||i.validate(async t=>{var m;if(t){j.value=!0;try{await X();const s=(m=h.product)==null?void 0:m.id;T();let l;h.product?l=await Oe(s,r):l=await Ae(r),l.data.code===0?(p.success(h.product?"编辑商品成功":"添加商品成功"),z("success")):p.error(l.data.msg||(h.product?"编辑商品失败":"添加商品失败"))}catch(s){console.error("提交商品数据出错",s),p.error("系统错误，请稍后重试")}finally{j.value=!1}}})},Y=()=>{z("close")};return(i,t)=>{const m=oe,s=de,l=ne,a=se,d=ce,O=Ve,P=Ie,g=Se,w=Ce,x=re,k=me,K=pe,L=fe;return u(),$(L,{title:A.product?"编辑商品":"添加商品",modelValue:A.visible,width:"700px",onClose:Y},{footer:o(()=>[v("div",lt,[e(x,{onClick:Y},{default:o(()=>t[22]||(t[22]=[b("取消")])),_:1}),e(x,{type:"primary",loading:j.value||M.value,onClick:F},{default:o(()=>t[23]||(t[23]=[b(" 确认 ")])),_:1},8,["loading"])])]),default:o(()=>[e(K,{ref_key:"formRef",ref:U,model:r,rules:G,"label-width":"100px",onSubmit:t[11]||(t[11]=xe(()=>{},["prevent"]))},{default:o(()=>[e(s,{label:"商品名称",prop:"name"},{default:o(()=>[e(m,{modelValue:r.name,"onUpdate:modelValue":t[0]||(t[0]=n=>r.name=n),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"商品副标题",prop:"subtitle"},{default:o(()=>[e(m,{modelValue:r.subtitle,"onUpdate:modelValue":t[1]||(t[1]=n=>r.subtitle=n),placeholder:"请输入商品副标题"},null,8,["modelValue"])]),_:1}),e(s,{label:"商品分类",prop:"categoryId"},{default:o(()=>[e(a,{modelValue:r.categoryId,"onUpdate:modelValue":t[2]||(t[2]=n=>r.categoryId=n),placeholder:"请选择商品分类",style:{width:"100%"}},{default:o(()=>[(u(!0),_(q,null,R(A.categories,n=>(u(),$(l,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"商品价格",prop:"price"},{default:o(()=>[e(d,{modelValue:r.price,"onUpdate:modelValue":t[3]||(t[3]=n=>r.price=n),min:0,precision:2,step:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(s,{label:"商品库存",prop:"stock"},{default:o(()=>[e(d,{modelValue:r.stock,"onUpdate:modelValue":t[4]||(t[4]=n=>r.stock=n),min:0,precision:0,step:1,style:{width:"100%"},disabled:r.hasSpecification===1},null,8,["modelValue","disabled"]),r.hasSpecification===1?(u(),_("div",He,t[12]||(t[12]=[v("small",null,"多规格商品的库存将自动计算，无需手动设置",-1)]))):D("",!0)]),_:1}),e(s,{label:"商品状态",prop:"status"},{default:o(()=>[e(P,{modelValue:r.status,"onUpdate:modelValue":t[5]||(t[5]=n=>r.status=n)},{default:o(()=>[e(O,{label:1},{default:o(()=>t[13]||(t[13]=[b("上架")])),_:1}),e(O,{label:2},{default:o(()=>t[14]||(t[14]=[b("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"启用规格"},{default:o(()=>[e(g,{modelValue:r.hasSpecification,"onUpdate:modelValue":t[6]||(t[6]=n=>r.hasSpecification=n),"active-value":1,"inactive-value":0,"inactive-text":"单规格","active-text":"多规格"},null,8,["modelValue"]),r.hasSpecification===1?(u(),_("div",Je,[e(w,{type:"info",closable:!1},{default:o(()=>t[15]||(t[15]=[v("p",null,'启用多规格功能后，请保存商品信息，然后在商品列表中点击"规格"按钮进行规格管理。',-1),v("p",null,"多规格商品的总库存将自动计算，无需在此设置。",-1)])),_:1})])):D("",!0)]),_:1}),e(s,{label:"商品主图",prop:"mainImage"},{default:o(()=>[v("div",Qe,[r.mainImage?(u(),_("div",Ye,[v("img",{src:r.mainImage,class:"avatar"},null,8,Ze),v("div",We,[e(x,{size:"small",type:"danger",onClick:t[7]||(t[7]=n=>{r.mainImage="",c.value=null})},{default:o(()=>t[16]||(t[16]=[b(" 删除 ")])),_:1})])])):(u(),_("div",{key:1,class:"upload-trigger",onClick:t[8]||(t[8]=n=>i.$refs.mainImageInput.click())},[e(k,{class:"upload-icon"},{default:o(()=>[e(ee(ae))]),_:1}),t[17]||(t[17]=v("span",null,"上传主图",-1))])),v("input",{ref:"mainImageInput",type:"file",accept:"image/*",style:{display:"none"},onChange:Z},null,544)]),t[18]||(t[18]=v("div",{class:"upload-tip"},"* 建议上传比例为1:1的图片，大小不超过2MB",-1))]),_:1}),e(s,{label:"商品图片集"},{default:o(()=>[v("div",Xe,[(u(!0),_(q,null,R(f.value,(n,I)=>(u(),_("div",{key:I,class:"sub-image-item"},[v("img",{src:n.url,class:"sub-image"},null,8,et),v("div",tt,[e(x,{size:"small",type:"danger",onClick:S=>Q(I)},{default:o(()=>t[19]||(t[19]=[b(" 删除 ")])),_:2},1032,["onClick"])])]))),128)),f.value.length<5?(u(),_("div",{key:0,class:"upload-trigger sub-trigger",onClick:t[9]||(t[9]=n=>i.$refs.subImageInput.click())},[e(k,{class:"upload-icon"},{default:o(()=>[e(ee(ae))]),_:1}),t[20]||(t[20]=v("span",null,"添加图片",-1))])):D("",!0),v("input",{ref:"subImageInput",type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:W},null,544)]),t[21]||(t[21]=v("div",{class:"upload-tip"},"* 最多上传5张商品详情图，每张大小不超过5MB",-1))]),_:1}),e(s,{label:"商品详情",prop:"detail"},{default:o(()=>[e(m,{modelValue:r.detail,"onUpdate:modelValue":t[10]||(t[10]=n=>r.detail=n),type:"textarea",rows:6,placeholder:"请输入商品详情描述，支持HTML格式"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},ot=ie(at,[["__scopeId","data-v-a174a04a"]]),st={class:"specification-manager"},nt={class:"spec-options-section"},rt={class:"spec-combinations-section"},it={key:0,class:"combinations-table"},ut={class:"actions"},dt={key:0,class:"existing-specs-section"},ct={key:0},mt={key:1},pt={key:0},ft={key:1},gt={key:0},vt={key:1},yt={class:"dialog-footer"},_t={__name:"SpecificationManager",props:{visible:{type:Boolean,default:!1},productId:{type:Number,required:!0},productSpecOptions:{type:Array,default:()=>[]}},emits:["close","success"],setup(A,{emit:B}){const h=A,z=B,U=V(!1),j=V(!1),r=V([{key:"color",customKey:"",values:[]}]),E=V([]),f=V([]),c=V(null),C={color:"颜色",size:"尺寸",material:"材质",style:"款式",custom:"自定义"};ge(async()=>{h.productId&&await Promise.all([M(),G()])});const M=async()=>{U.value=!0;try{const s=await De(h.productId);s.data.code===0?f.value=s.data.data||[]:p.error(s.data.msg||"获取商品规格失败")}catch(s){console.error("获取商品规格出错",s),p.error("获取商品规格出错")}finally{U.value=!1}},G=async()=>{try{const s=await ke(h.productId);if(s.data.code===0&&s.data.data){const l=s.data.data;console.log("规格选项:",l),r.value=[],l.forEach(a=>{const d=Object.keys(C).includes(a.specKey);r.value.push({key:d?a.specKey:"custom",customKey:d?"":a.specKey,values:a.specValues||[]})}),r.value.length===0&&r.value.push({key:"color",customKey:"",values:[]})}}catch(s){console.error("获取规格选项出错",s)}},H=s=>C[s]||s,J=()=>{r.value.push({key:"",customKey:"",values:[]})},Z=s=>{r.value.splice(s,1)},W=()=>{const s=r.value.filter(a=>a.key&&a.values&&a.values.length>0&&(a.key!=="custom"||a.key==="custom"&&a.customKey));if(s.length===0){p.warning("请至少添加一个有效的规格选项");return}const l={};s.forEach(a=>{const d=a.key==="custom"?a.customKey:a.key;l[d]=a.values}),E.value=X(l)},X=s=>{const l=Object.keys(s);if(l.length===0)return[];const a=(d,O)=>{if(d===l.length)return[{specs:{...O},priceAdjustment:0,stock:100}];const P=l[d],g=s[P],w=[];return g.forEach(x=>{const k={...O};k[P]=x,w.push(...a(d+1,k))}),w};return a(0,{})},Q=async()=>{if(E.value.length===0){p.warning("请先生成规格组合");return}j.value=!0;const s=Pe.service({lock:!0,text:"正在保存所有规格...",background:"rgba(0, 0, 0, 0.7)"});try{const l={};r.value.forEach(g=>{if(g.values&&g.values.length>0){const w=g.key==="custom"?g.customKey:g.key;w&&(l[w]=g.values)}});const a=[],d=[],O=E.value.length,P=p({type:"info",message:"正在保存规格...",duration:0,showClose:!0});await new Promise(g=>{let w=0;const x=async()=>{if(w>=E.value.length){g();return}const k=E.value[w];P.message=`正在保存规格... (${w+1}/${O})`;try{const K=await Ne(h.productId,{specifications:k.specs,priceAdjustment:k.priceAdjustment,stock:k.stock});a.push(K)}catch(K){console.error("保存规格失败:",K),d.push(k)}w++,setTimeout(x,30)};x()}),P.close(),d.length===0?p.success("所有规格保存成功"):(p.warning(`保存完成，但有${d.length}个规格保存失败`),console.error("保存失败的规格:",d)),await M(),E.value=[]}catch(l){console.error("保存规格失败:",l),p.error("保存规格失败，请稍后重试")}finally{s.close(),j.value=!1}},T=s=>{c.value={...s}},F=async()=>{if(c.value)try{const s=await Be(c.value.id,{priceAdjustment:c.value.priceAdjustment,stock:c.value.stock});s.data.code===0?(p.success("更新规格成功"),await M(),c.value=null):p.error(s.data.msg||"更新规格失败")}catch(s){console.error("更新规格出错",s),p.error("更新规格失败")}},Y=()=>{c.value=null},i=s=>{we.confirm("确认删除该规格？此操作不可恢复","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await Ke(s);l.data.code===0?(p.success("删除规格成功"),await M()):p.error(l.data.msg||"删除规格失败")}catch(l){console.error("删除规格出错",l),p.error("删除规格失败")}}).catch(()=>{})},t=()=>{z("close")},m=()=>{z("success"),t()};return(s,l)=>{const a=ne,d=se,O=oe,P=me,g=re,w=_e,x=ce,k=be,K=fe,L=ye;return u(),$(K,{title:"商品规格管理",modelValue:A.visible,width:"800px",onClose:t},{footer:o(()=>[v("div",yt,[e(g,{onClick:t},{default:o(()=>l[11]||(l[11]=[b("关闭")])),_:1}),e(g,{type:"primary",onClick:m},{default:o(()=>l[12]||(l[12]=[b("完成")])),_:1})])]),default:o(()=>[ve((u(),_("div",st,[v("div",nt,[l[2]||(l[2]=v("h4",null,"步骤1: 添加规格类型和选项",-1)),(u(!0),_(q,null,R(r.value,(n,I)=>(u(),_("div",{key:I,class:"spec-option-row"},[e(d,{modelValue:n.key,"onUpdate:modelValue":S=>n.key=S,placeholder:"规格类型",style:{width:"120px"}},{default:o(()=>[e(a,{label:"颜色",value:"color"}),e(a,{label:"尺寸",value:"size"}),e(a,{label:"材质",value:"material"}),e(a,{label:"款式",value:"style"}),e(a,{label:"自定义",value:"custom"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),n.key==="custom"?(u(),$(O,{key:0,modelValue:n.customKey,"onUpdate:modelValue":S=>n.customKey=S,placeholder:"请输入规格类型名称",style:{width:"150px",margin:"0 10px"}},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),e(d,{modelValue:n.values,"onUpdate:modelValue":S=>n.values=S,multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"规格选项值",style:{width:"450px",margin:"0 10px"}},{default:o(()=>[(u(!0),_(q,null,R(A.productSpecOptions.get&&n.key?A.productSpecOptions.get(n.key):[],S=>(u(),$(a,{key:S,label:S,value:S},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),I===r.value.length-1?(u(),$(g,{key:1,type:"primary",circle:"",onClick:J},{default:o(()=>[e(P,null,{default:o(()=>[e(ee(ae))]),_:1})]),_:1})):D("",!0),r.value.length>1?(u(),$(g,{key:2,type:"danger",circle:"",onClick:S=>Z(I)},{default:o(()=>[e(P,null,{default:o(()=>[e(ee(Ee))]),_:1})]),_:2},1032,["onClick"])):D("",!0)]))),128))]),v("div",rt,[l[5]||(l[5]=v("h4",null,"步骤2: 生成规格组合",-1)),e(g,{type:"primary",onClick:W},{default:o(()=>l[3]||(l[3]=[b("生成规格组合")])),_:1}),E.value.length>0?(u(),_("div",it,[e(k,{data:E.value,border:"",style:{width:"100%","margin-top":"20px"}},{default:o(()=>[e(w,{label:"规格组合"},{default:o(n=>[(u(!0),_(q,null,R(n.row.specs,(I,S)=>(u(),_("div",{key:S},N(H(S))+": "+N(I),1))),128))]),_:1}),e(w,{label:"价格调整",width:"150"},{default:o(n=>[e(x,{modelValue:n.row.priceAdjustment,"onUpdate:modelValue":I=>n.row.priceAdjustment=I,precision:2,step:10,min:-1e3,max:1e3},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{label:"库存",width:"150"},{default:o(n=>[e(x,{modelValue:n.row.stock,"onUpdate:modelValue":I=>n.row.stock=I,min:0,max:9999},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]),v("div",ut,[e(g,{type:"primary",loading:j.value,onClick:Q},{default:o(()=>l[4]||(l[4]=[b(" 保存所有规格 ")])),_:1},8,["loading"])])])):D("",!0)]),f.value.length>0?(u(),_("div",dt,[l[10]||(l[10]=v("h4",null,"现有规格组合",-1)),e(k,{data:f.value,border:"",style:{width:"100%"}},{default:o(()=>[e(w,{label:"规格组合"},{default:o(n=>[(u(!0),_(q,null,R(n.row.specifications,(I,S)=>(u(),_("div",{key:S},N(H(S))+": "+N(I),1))),128))]),_:1}),e(w,{label:"价格调整",width:"120"},{default:o(n=>[c.value&&c.value.id===n.row.id?(u(),_("span",ct,[e(x,{modelValue:c.value.priceAdjustment,"onUpdate:modelValue":l[0]||(l[0]=I=>c.value.priceAdjustment=I),precision:2,step:10,min:-1e3,max:1e3,size:"small",style:{width:"100px"}},null,8,["modelValue"])])):(u(),_("span",mt,N(n.row.priceAdjustment),1))]),_:1}),e(w,{label:"库存",width:"100"},{default:o(n=>[c.value&&c.value.id===n.row.id?(u(),_("span",pt,[e(x,{modelValue:c.value.stock,"onUpdate:modelValue":l[1]||(l[1]=I=>c.value.stock=I),min:0,max:9999,size:"small",style:{width:"90px"}},null,8,["modelValue"])])):(u(),_("span",ft,N(n.row.stock),1))]),_:1}),e(w,{label:"销量",width:"100"},{default:o(n=>[b(N(n.row.sales||0),1)]),_:1}),e(w,{label:"操作",width:"160"},{default:o(n=>[c.value&&c.value.id===n.row.id?(u(),_("div",gt,[e(g,{type:"success",size:"small",onClick:F},{default:o(()=>l[6]||(l[6]=[b(" 保存 ")])),_:1}),e(g,{size:"small",onClick:Y},{default:o(()=>l[7]||(l[7]=[b(" 取消 ")])),_:1})])):(u(),_("div",vt,[e(g,{type:"primary",size:"small",onClick:I=>T(n.row)},{default:o(()=>l[8]||(l[8]=[b(" 编辑 ")])),_:2},1032,["onClick"]),e(g,{type:"danger",size:"small",onClick:I=>i(n.row.id)},{default:o(()=>l[9]||(l[9]=[b(" 删除 ")])),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["data"])])):D("",!0)])),[[L,U.value]])]),_:1},8,["modelValue"])}}},bt=ie(_t,[["__scopeId","data-v-f59dd560"]]),wt={class:"product-management"},kt={class:"card-header"},ht={class:"search-filter"},It={class:"pagination-container"},Vt={__name:"ProductManagement",setup(A){const B=V(!1),h=V(!1),z=V(null),U=V(!1),j=V(null),r=V([]),E=V([]),f=le({keyword:"",categoryId:"",status:""}),c=le({pageNum:1,pageSize:6,total:0});ge(async()=>{await Promise.all([C(),M()])});const C=async()=>{B.value=!0;try{const l={pageNum:c.pageNum,pageSize:c.pageSize,keyword:f.keyword,categoryId:f.categoryId,status:f.status},a=await Te(l);a.data.code===0?(r.value=a.data.data.list||[],c.total=a.data.data.total||0):p.error(a.data.msg||"获取商品列表失败")}catch(l){console.error("获取商品列表出错",l),p.error("获取商品列表出错")}finally{B.value=!1}},M=async()=>{try{const l=await Fe();l.data.code===0?E.value=l.data.data||[]:p.error(l.data.msg||"获取分类列表失败")}catch(l){console.error("获取分类列表出错",l),p.error("获取分类列表出错")}},G=()=>{c.pageNum=1,C()},H=()=>{Object.keys(f).forEach(l=>{f[l]=""}),G()},J=l=>{c.pageSize=l,C()},Z=l=>{c.pageNum=l,C()},W=()=>{z.value=null,h.value=!0},X=async l=>{try{B.value=!0;const a=await qe(l.id);a.data.code===0?(z.value={...l,...a.data.data,id:l.id,categoryId:l.categoryId,categoryName:l.categoryName},h.value=!0,console.log(z.value)):p.error(a.data.msg||"获取商品详情失败")}catch(a){console.error("获取商品详情出错",a),p.error("获取商品详情失败")}finally{B.value=!1}},Q=async(l,a)=>{try{let d;a==="on"?d=await Le(l):d=await Re(l),d.data.code===0?(p.success(a==="on"?"商品上架成功":"商品下架成功"),C()):p.error(d.data.msg||"操作失败")}catch(d){console.error("操作商品状态出错",d),p.error("操作失败")}},T=l=>{we.confirm("确认删除该商品？此操作不可恢复","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await Ge(l);a.data.code===0?(p.success("删除商品成功"),C()):p.error(a.data.msg||"删除商品失败")}catch(a){console.error("删除商品出错",a),p.error("删除商品失败")}}).catch(()=>{})},F=new Map,Y=async l=>{j.value=l;const a=await ke(l);if(a.data.code===0){for(const d of a.data.data)F.set(d.specKey,d.specValues);console.log(F)}else p.error(a.data.msg||"获取商品规格失败");U.value=!0},i=()=>{h.value=!1,z.value=null},t=()=>{U.value=!1,j.value=null},m=()=>{C(),i()},s=()=>{C(),t()};return(l,a)=>{const d=re,O=oe,P=de,g=ne,w=se,x=pe,k=_e,K=ze,L=Ue,n=be,I=je,S=$e,he=ye;return u(),_("div",wt,[e(S,{class:"management-card"},{header:o(()=>[v("div",kt,[a[4]||(a[4]=v("h2",null,"商品管理",-1)),e(d,{type:"primary",onClick:W},{default:o(()=>a[3]||(a[3]=[b("添加商品")])),_:1})])]),default:o(()=>[v("div",ht,[e(x,{inline:!0,model:f,class:"search-form"},{default:o(()=>[e(P,{label:"关键词"},{default:o(()=>[e(O,{modelValue:f.keyword,"onUpdate:modelValue":a[0]||(a[0]=y=>f.keyword=y),placeholder:"商品名称",clearable:""},null,8,["modelValue"])]),_:1}),e(P,{label:"分类"},{default:o(()=>[e(w,{modelValue:f.categoryId,"onUpdate:modelValue":a[1]||(a[1]=y=>f.categoryId=y),placeholder:"全部分类",clearable:"",style:{width:"160px"}},{default:o(()=>[e(g,{label:"全部分类",value:""}),(u(!0),_(q,null,R(E.value,y=>(u(),$(g,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(P,{label:"状态"},{default:o(()=>[e(w,{modelValue:f.status,"onUpdate:modelValue":a[2]||(a[2]=y=>f.status=y),placeholder:"全部状态",clearable:"",style:{width:"160px"}},{default:o(()=>[e(g,{label:"全部状态",value:""}),e(g,{label:"在售",value:1}),e(g,{label:"下架",value:2})]),_:1},8,["modelValue"])]),_:1}),e(P,null,{default:o(()=>[e(d,{type:"primary",onClick:G},{default:o(()=>a[5]||(a[5]=[b("搜索")])),_:1}),e(d,{onClick:H},{default:o(()=>a[6]||(a[6]=[b("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),ve((u(),$(n,{data:r.value,style:{width:"100%"},border:""},{default:o(()=>[e(k,{prop:"id",label:"ID",width:"80"}),e(k,{label:"商品图片",width:"100"},{default:o(y=>[e(K,{style:{width:"60px",height:"60px"},src:y.row.mainImage,"preview-src-list":[y.row.mainImage],fit:"cover"},null,8,["src","preview-src-list"])]),_:1}),e(k,{prop:"name",label:"商品名称","min-width":"160","show-overflow-tooltip":""}),e(k,{prop:"subtitle",label:"副标题","min-width":"200","show-overflow-tooltip":""}),e(k,{prop:"categoryName",label:"分类",width:"100"}),e(k,{prop:"price",label:"价格",width:"100"},{default:o(y=>[v("span",null,"¥"+N(y.row.price),1)]),_:1}),e(k,{prop:"stock",label:"库存",width:"80"}),e(k,{prop:"status",label:"状态",width:"100"},{default:o(y=>[e(L,{type:y.row.status===1?"success":"info"},{default:o(()=>[b(N(y.row.status===1?"在售":"下架"),1)]),_:2},1032,["type"])]),_:1}),e(k,{label:"规格",width:"100"},{default:o(y=>[y.row.hasSpecification===1?(u(),$(L,{key:0,type:"warning"},{default:o(()=>a[7]||(a[7]=[b("多规格")])),_:1})):(u(),$(L,{key:1,type:"info"},{default:o(()=>a[8]||(a[8]=[b("单规格")])),_:1}))]),_:1}),e(k,{label:"操作",width:"320",fixed:"right"},{default:o(y=>[y.row.status===2?(u(),$(d,{key:0,type:"success",size:"small",onClick:te=>Q(y.row.id,"on")},{default:o(()=>a[9]||(a[9]=[b(" 上架 ")])),_:2},1032,["onClick"])):(u(),$(d,{key:1,type:"warning",size:"small",onClick:te=>Q(y.row.id,"off")},{default:o(()=>a[10]||(a[10]=[b(" 下架 ")])),_:2},1032,["onClick"])),e(d,{type:"primary",size:"small",onClick:te=>X(y.row)},{default:o(()=>a[11]||(a[11]=[b(" 编辑 ")])),_:2},1032,["onClick"]),e(d,{type:"info",size:"small",onClick:te=>Y(y.row.id)},{default:o(()=>a[12]||(a[12]=[b(" 规格 ")])),_:2},1032,["onClick"]),e(d,{type:"danger",size:"small",onClick:te=>T(y.row.id)},{default:o(()=>a[13]||(a[13]=[b(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[he,B.value]]),v("div",It,[e(I,{background:"",layout:"total, sizes, prev, pager, next, jumper","current-page":c.pageNum,"page-size":c.pageSize,"page-sizes":[6,8,10,15],total:c.total,onSizeChange:J,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),h.value?(u(),$(ot,{key:0,visible:h.value,product:z.value,categories:E.value,onClose:i,onSuccess:m},null,8,["visible","product","categories"])):D("",!0),U.value?(u(),$(bt,{key:1,visible:U.value,"product-id":j.value,"product-spec-options":ee(F),onClose:t,onSuccess:s},null,8,["visible","product-id","product-spec-options"])):D("",!0)])}}},Ht=ie(Vt,[["__scopeId","data-v-e43cbfaf"]]);export{Ht as default};
