import{r as k,K as ae,d as H,L as M,o as Q,q as p,p as g,i as u,P as B,Q as V,l as s,B as m,O as z,j as i,ad as se,E as I,al as ce,M as le,_ as oe,f as O,w as d,am as ie,ah as ne,an as ue,ao as re,b as de,ap as pe,F as S,ai as ve,a3 as me,a4 as fe,m as _e,n as ye,s as he,ac as be,aq as ke}from"./index-CHTw6ThQ.js";/* empty css                   *//* empty css                    *//* empty css               *//* empty css                 *//* empty css                  *//* empty css                         *//* empty css                        *//* empty css                           */import{c as ge,d as Se,e as Ie}from"./shop-CQ1xGz2h.js";import{u as we}from"./cart-_Tla4ces.js";/* empty css                 */import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={key:0,class:"spec-selector"},Ce={class:"spec-title"},Ae={class:"spec-values"},je=["onClick"],Ee={key:0,class:"spec-info"},Ne={class:"price-info"},xe={class:"price"},$e={key:0,class:"adjustment"},Be={class:"stock-info"},Ve={key:1,class:"spec-hint"},qe={__name:"SpecificationSelector",props:{productId:{type:[String,Number],required:!0},basePrice:{type:Number,required:!0},hasSpecification:{type:Boolean,default:!1},specifications:{type:Array,default:()=>[]}},emits:["specification-selected","specification-change"],setup(q,{emit:E}){const n=q,N=E,h=k([]),e=ae({}),l=k(null),w=k(!1),o=H(()=>l.value?(n.basePrice+l.value.priceAdjustment).toFixed(2):n.basePrice.toFixed(2)),_=c=>({color:"颜色",size:"尺码",material:"材质",style:"款式"})[c]||c,v=(c,r)=>!n.specifications.some(b=>b.specifications[c]===r&&b.stock>0),K=(c,r)=>{e[c]=r,T()},T=()=>{const c=Object.keys(e),r=[];for(const f of h.value)r.push(f.specKey);if(c.length!==r.length){l.value=null,N("specification-change",null);return}const b=n.specifications.find(f=>r.every(y=>f.specifications[y]===e[y]));b?(l.value=b,N("specification-selected",b)):x()},x=async()=>{w.value=!0;try{const c=await Se(n.productId,e);c.data.code===0?l.value=c.data.data:I.warning("获取规格信息失败，请重新选择")}catch(c){I.error(c.msg)}finally{w.value=!1}},C=()=>{!n.hasSpecification||!n.productId||(w.value=!0,ge(n.productId).then(c=>{c.data.code===0&&(h.value=c.data.data)}).catch(c=>{I.error(c.msg)}).finally(()=>{w.value=!1}))};return M(()=>n.productId,()=>{n.productId&&n.hasSpecification&&C()},{immediate:!0}),M(()=>n.hasSpecification,c=>{c&&n.productId?C():(h.value={},Object.keys(e).forEach(r=>delete e[r]),l.value=null)},{immediate:!0}),M(()=>e,()=>{e&&x()},{deep:!0}),Q(()=>{n.productId&&n.hasSpecification&&C()}),(c,r)=>{const b=se;return q.hasSpecification?(u(),p("div",Pe,[(u(!0),p(B,null,V(h.value,f=>(u(),p("div",{key:f.id,class:"spec-group"},[s("div",Ce,m(_(f.specKey))+":",1),s("div",Ae,[(u(!0),p(B,null,V(f.specValues,y=>(u(),p("span",{key:y,class:z(["spec-value",e[f.specKey]===y?"selected":"",v(f.specKey,y)?"disabled":""]),onClick:F=>!v(f.specKey,y)&&K(f.specKey,y)},m(y),11,je))),128))])]))),128)),l.value?(u(),p("div",Ee,[s("div",Ne,[r[0]||(r[0]=s("span",{class:"label"},"现价:",-1)),s("span",xe,"¥"+m(o.value),1),l.value.priceAdjustment!==0?(u(),p("span",$e," ("+m(l.value.priceAdjustment>0?"+":"")+m(l.value.priceAdjustment)+") ",1)):g("",!0)]),s("div",Be,[r[1]||(r[1]=s("span",{class:"label"},"库存:",-1)),s("span",{class:z(["stock",{"low-stock":l.value.stock<10}])},m(l.value.stock>0?l.value.stock:"无货"),3)])])):g("",!0),!l.value&&Object.keys(e).length>0?(u(),p("div",Ve,[i(b,{title:"请选择完整的规格组合",type:"warning",closable:!1,"show-icon":""})])):g("",!0)])):g("",!0)}}},Ke=U(qe,[["__scopeId","data-v-828efb6c"]]),Te={class:"product-detail"},De={key:0},Me={class:"product-gallery"},Oe={key:1,class:"thumbnail-list"},ze=["onClick"],Fe={class:"product-info"},Le={class:"product-name"},Re={class:"product-subtitle"},He={class:"product-meta"},Qe={class:"price-row"},Ue={class:"price"},Je={class:"stock-row"},Ge={class:"sales-row"},We={class:"sales"},Xe={key:0,class:"spec-selection"},Ye={class:"quantity-selection"},Ze={class:"quantity-control"},et={class:"total-price-section"},tt={class:"total-price"},at={class:"action-buttons"},st={class:"product-detail-content"},ct=["innerHTML"],lt={__name:"ProductDetail",setup(q){const E=ce(),n=de(),N=we(),h=k(!0),e=k(null),l=k([]),w=k("detail"),o=k(null),_=k(!1),v=k(1),K=H(()=>{if(!e.value)return 0;let t=e.value.price;return e.value.hasSpecification===1&&o.value&&(t=Number(t)+Number(o.value.priceAdjustment)),(t*v.value).toFixed(2)}),T=async t=>{h.value=!0;try{const a=await Ie(t);a.data.code===0&&(e.value=a.data.data,e.value.hasSpecification===0&&e.value.stock&&(_.value=!0),x())}catch(a){console.error("获取商品详情失败:",a),I.error("获取商品详情失败")}finally{h.value=!1}},x=()=>{if(e.value&&(l.value=[],e.value.mainImage&&l.value.push(e.value.mainImage),e.value.subImages)){let t=e.value.subImages;typeof t=="string"?t=t.split(",").map(a=>a.trim()):Array.isArray(t)&&(t=[...t]),l.value.push(...t)}},C=t=>{o.value=t,_.value=t&&t.stock>0,v.value=1},c=()=>{_.value=!1},r=()=>{const t=e.value.hasSpecification===1&&o.value?o.value.stock:e.value.stock;v.value<t?v.value++:I.warning("已达到最大库存数量")},b=()=>{v.value>1&&v.value--},f=async()=>{if(!_.value){I.warning("请先选择有效的商品规格");return}const t={productId:e.value.id,productName:e.value.name,productImage:e.value.mainImage,productPrice:e.value.price,quantity:v.value,stock:e.value.hasSpecification===1&&o.value?o.value.stock:e.value.stock,selected:!0};e.value.hasSpecification===1&&o.value?(t.specificationId=o.value.id,t.specs=o.value.specifications,t.priceAdjustment=o.value.priceAdjustment):t.priceAdjustment=0,await N.addToCart(t)&&I.success("已添加到购物车")},y=async()=>{if(!_.value){I.warning("请先选择有效的商品规格");return}const t={productId:e.value.id,productName:e.value.name,productImage:e.value.mainImage,productPrice:e.value.price,quantity:v.value,stock:e.value.hasSpecification===1&&o.value?o.value.stock:e.value.stock,selected:!0};e.value.hasSpecification===1&&o.value?(t.specificationId=o.value.id,t.specs=o.value.specifications,t.priceAdjustment=o.value.priceAdjustment):t.priceAdjustment=0;const a=t.productPrice+(t.priceAdjustment||0),A=a*t.quantity;t.actualPrice=a;const D={products:[t],totalAmount:A,isBuyNow:!0};localStorage.setItem("checkout_order",JSON.stringify(D)),n.push("/checkout")},F=()=>{n.push("/shop")};return Q(()=>{const t=E.params.id;t?T(t):h.value=!1}),(t,a)=>{const A=pe,D=ie,L=_e,J=fe,G=me,R=ve,j=he,W=be,X=ne,Y=ke,Z=ue,ee=re,te=oe;return le((u(),p("div",Te,[e.value?(u(),p("div",De,[i(D,{separator:"/"},{default:d(()=>[i(A,{to:{path:"/"}},{default:d(()=>a[2]||(a[2]=[S("首页")])),_:1}),i(A,{to:{path:"/shop",query:{categoryId:e.value.categoryId}}},{default:d(()=>[S(m(e.value.categoryName),1)]),_:1},8,["to"]),i(A,null,{default:d(()=>[S(m(e.value.name),1)]),_:1})]),_:1}),i(X,{gutter:30,class:"product-info-container"},{default:d(()=>[i(R,{span:12},{default:d(()=>[s("div",Me,[l.value.length>0?(u(),O(G,{key:0,interval:4e3,type:"card",height:"400px",ref:"carousel"},{default:d(()=>[(u(!0),p(B,null,V(l.value,(P,$)=>(u(),O(J,{key:$},{default:d(()=>[i(L,{src:P,fit:"contain",class:"carousel-image"},null,8,["src"])]),_:2},1024))),128))]),_:1},512)):g("",!0),l.value.length>1?(u(),p("div",Oe,[(u(!0),p(B,null,V(l.value,(P,$)=>(u(),p("div",{key:$,class:"thumbnail-item",onClick:ot=>t.$refs.carousel.setActiveItem($)},[i(L,{src:P,fit:"cover"},null,8,["src"])],8,ze))),128))])):g("",!0)])]),_:1}),i(R,{span:12},{default:d(()=>[s("div",Fe,[s("h1",Le,m(e.value.name),1),s("p",Re,m(e.value.subtitle),1),s("div",He,[s("div",Qe,[a[3]||(a[3]=s("span",{class:"label"},"原价:",-1)),s("span",Ue,"¥"+m(e.value.price.toFixed(2)),1)]),s("div",Je,[a[4]||(a[4]=s("span",{class:"label"},"库存:",-1)),s("span",{class:z(["stock",{"low-stock":e.value.stock<10}])},m(e.value.stock>0?e.value.stock:"无货"),3)]),s("div",Ge,[a[5]||(a[5]=s("span",{class:"label"},"销量:",-1)),s("span",We,m(e.value.sales),1)])]),e.value.hasSpecification===1?(u(),p("div",Xe,[i(Ke,{productId:Number(ye(E).params.id),basePrice:e.value.price,hasSpecification:e.value.hasSpecification===1,specifications:e.value.specifications,onSpecificationSelected:C,onSpecificationChange:c},null,8,["productId","basePrice","hasSpecification","specifications"])])):g("",!0),s("div",Ye,[a[8]||(a[8]=s("span",{class:"label"},"数量:",-1)),s("div",Ze,[i(j,{type:"primary",circle:"",size:"small",onClick:b,disabled:v.value<=1},{default:d(()=>a[6]||(a[6]=[S("-")])),_:1},8,["disabled"]),i(W,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=P=>v.value=P),min:1,max:e.value.hasSpecification===1&&o.value?o.value.stock:e.value.stock,size:"small",style:{width:"120px"},disabled:!_.value},null,8,["modelValue","max","disabled"]),i(j,{type:"primary",circle:"",size:"small",onClick:r,disabled:!_.value},{default:d(()=>a[7]||(a[7]=[S("+")])),_:1},8,["disabled"])])]),s("div",et,[a[9]||(a[9]=s("span",{class:"label"},"总价:",-1)),s("span",tt,"¥"+m(K.value),1)]),s("div",at,[i(j,{type:"primary",size:"large",disabled:!_.value,onClick:f},{default:d(()=>a[10]||(a[10]=[S(" 加入购物车 ")])),_:1},8,["disabled"]),i(j,{type:"danger",size:"large",disabled:!_.value,onClick:y},{default:d(()=>a[11]||(a[11]=[S(" 立即购买 ")])),_:1},8,["disabled"])])])]),_:1})]),_:1}),s("div",st,[i(Z,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=P=>w.value=P)},{default:d(()=>[i(Y,{label:"商品详情",name:"detail"},{default:d(()=>[s("div",{class:"detail-content",innerHTML:e.value.detail},null,8,ct)]),_:1})]),_:1},8,["modelValue"])])])):g("",!0),!h.value&&!e.value?(u(),O(ee,{key:1,icon:"error",title:"商品加载失败","sub-title":"未找到商品信息或者商品已下架"},{extra:d(()=>[i(j,{type:"primary",onClick:F},{default:d(()=>a[12]||(a[12]=[S("返回商城")])),_:1})]),_:1})):g("",!0)])),[[te,h.value]])}}},kt=U(lt,[["__scopeId","data-v-a652f22b"]]);export{kt as default};
