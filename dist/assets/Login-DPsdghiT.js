import{u as M,r as y,L as P,q as T,f as k,p as q,w as l,P as j,ah as D,b as O,h as A,i as V,j as a,ai as W,ae as G,ab as H,l as x,ac as J,n as v,z as $,bf as S,bg as K,s as Q,F as m,B as X,b5 as Y,at as Z,E as i}from"./index-CZU4bJ5v.js";/* empty css               *//* empty css                    *//* empty css                     *//* empty css                *//* empty css                  *//* empty css                 */import{V as h,a as ee,b as ae,c as le}from"./VerificationCodeInput-BALEV3uv.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"verify-code-section"},se={class:"flex"},te={name:"LoginView"},ue=Object.assign(te,{setup(ne){const C=M(),b=O(),g=y(!1),o=y({username:"",password:"",email:"",verificationCode:""}),f=y(!1),d=y(0);let c=null;const U={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:10,message:"请输入5-10位用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],repassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(t,e,p)=>{e!==o.value.password?p(new Error("请输入相同的密码")):p()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入6位验证码",trigger:"blur"}]},_=y();P(g,()=>{o.value={username:"",password:"",repassword:"",email:"",verificationCode:""},c&&(clearInterval(c),c=null),f.value=!1,d.value=0});const B=async()=>{try{await _.value.validateField(["email"]),f.value=!0;const t=await ee({email:o.value.email,type:"register"});t.data.code===0?(i.success("验证码已发送至您的邮箱"),d.value=60,c=setInterval(()=>{d.value--,d.value<=0&&(clearInterval(c),c=null,f.value=!1)},1e3)):(i.error(t.data.msg||"发送验证码失败"),f.value=!1)}catch(t){console.error("发送验证码错误:",t),i.error("发送验证码失败，请检查邮箱格式"),f.value=!1}},F=async()=>{await _.value.validate();const t=await ae(o.value);t.data.code===0?(i.success("注册成功"),g.value=!1):i.error(t.data.msg||"注册失败")},L=async()=>{var t,e,p;await _.value.validate();try{const n=await le(o.value);if(n.data.code===0){i.success("登录成功");const r=n.data.data.token;C.setToken(r),await C.getUserinfo();const u=b.currentRoute.value.query.redirect||"/";if(((t=C.userinfo)==null?void 0:t.role)==="ROLE_ADMIN"){const w=u.startsWith("/admin")?u:"/admin";b.push(w)}else b.push(u)}else i.error(n.data.message)}catch(n){i.error(`登录失败: ${((p=(e=n.response)==null?void 0:e.data)==null?void 0:p.message)||n.message||"未知错误"}`)}},R=()=>{b.push("/login/forget-password")};return(t,e)=>{const p=A("router-view"),n=W,r=H,u=J,w=Q,E=Y,I=G,N=Z,z=D;return V(),T(j,null,[t.$route.path!=="/login"?(V(),k(p,{key:0})):q("",!0),t.$route.path==="/login"?(V(),k(z,{key:1,class:"login-page"},{default:l(()=>[a(n,{span:12,class:"bg"}),a(n,{span:6,offset:3,class:"form"},{default:l(()=>[g.value?(V(),k(I,{key:0,model:o.value,rules:U,ref_key:"form",ref:_,size:"large",autocomplete:"off"},{default:l(()=>[a(r,null,{default:l(()=>e[9]||(e[9]=[x("h1",null,"注册",-1)])),_:1}),a(r,{prop:"username"},{default:l(()=>[a(u,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.username=s),"prefix-icon":v($),placeholder:"请输入用户名"},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,{prop:"password"},{default:l(()=>[a(u,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.password=s),"prefix-icon":v(S),type:"password",placeholder:"请输入密码"},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,{prop:"repassword"},{default:l(()=>[a(u,{modelValue:o.value.repassword,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.repassword=s),"prefix-icon":v(S),type:"password",placeholder:"请输入再次密码"},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,{prop:"email"},{default:l(()=>[a(u,{modelValue:o.value.email,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.email=s),"prefix-icon":v(K),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,{prop:"verificationCode"},{default:l(()=>[x("div",re,[a(h,{modelValue:o.value.verificationCode,"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.verificationCode=s),length:6},null,8,["modelValue"]),a(w,{type:"primary",disabled:f.value||d.value>0,onClick:B,class:"verify-code-btn"},{default:l(()=>[m(X(d.value>0?`${d.value}秒后重新获取`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1}),a(r,null,{default:l(()=>[a(w,{onClick:F,class:"button",type:"primary","auto-insert-space":""},{default:l(()=>e[10]||(e[10]=[m(" 注册 ")])),_:1})]),_:1}),a(r,{class:"flex"},{default:l(()=>[a(E,{type:"info",underline:!1,onClick:e[5]||(e[5]=s=>g.value=!1)},{default:l(()=>e[11]||(e[11]=[m(" ← 返回 ")])),_:1})]),_:1})]),_:1},8,["model"])):(V(),k(I,{key:1,model:o.value,rules:U,ref_key:"form",ref:_,size:"large",autocomplete:"off"},{default:l(()=>[a(r,null,{default:l(()=>e[12]||(e[12]=[x("h1",null,"登录",-1)])),_:1}),a(r,{prop:"username"},{default:l(()=>[a(u,{modelValue:o.value.username,"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.username=s),"prefix-icon":v($),placeholder:"请输入用户名"},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,{prop:"password"},{default:l(()=>[a(u,{modelValue:o.value.password,"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.password=s),name:"password","prefix-icon":v(S),type:"password",placeholder:"请输入密码"},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,{class:"flex"},{default:l(()=>[x("div",se,[a(N,null,{default:l(()=>e[13]||(e[13]=[m("记住我")])),_:1}),a(E,{type:"primary",underline:!1,onClick:R},{default:l(()=>e[14]||(e[14]=[m("忘记密码？")])),_:1})])]),_:1}),a(r,null,{default:l(()=>[a(w,{onClick:L,class:"button",type:"primary","auto-insert-space":""},{default:l(()=>e[15]||(e[15]=[m("登录")])),_:1})]),_:1}),a(r,{class:"flex"},{default:l(()=>[a(E,{type:"info",underline:!1,onClick:e[8]||(e[8]=s=>g.value=!0)},{default:l(()=>e[16]||(e[16]=[m(" 注册 → ")])),_:1})]),_:1})]),_:1},8,["model"]))]),_:1})]),_:1})):q("",!0)],64)}}}),we=oe(ue,[["__scopeId","data-v-fea64dc0"]]);export{we as default};
