import{r as y,o as S,E as u,b,q as c,p as i,l as t,j as d,w as f,s as O,m as j,B as o,P as F,Q as A,ac as V,i as l,F as k}from"./index-CHTw6ThQ.js";/* empty css                 *//* empty css                        *//* empty css                  */import{c as q,a as B,B as C}from"./pay-BK3Jx5pZ.js";import{u as E}from"./cart-_Tla4ces.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={key:0,class:"checkout-container"},L={class:"checkout-header"},M={class:"checkout-section"},D={key:0,class:"product-info"},J={class:"product-details"},U={class:"product-name"},$={key:0,class:"product-specs"},z={class:"product-price"},Q={class:"product-quantity"},R={class:"product-subtotal"},Y={class:"price"},G={key:1},H={class:"product-details"},K={class:"product-name"},W={key:0,class:"product-specs"},X={class:"product-price"},Z={class:"product-quantity"},tt={class:"product-subtotal"},et={class:"price"},st={class:"checkout-section"},ot={class:"checkout-section order-amount"},at={class:"amount-item"},rt={class:"amount-item total"},ct={class:"price"},lt={class:"checkout-footer"},nt={class:"total-payment"},ut={class:"price"},it={__name:"CheckoutView",setup(dt){const p=b(),g=E(),s=y(null),_=y(""),m=y(!1),x=()=>{p.push("/cart")},I=async()=>{try{m.value=!0;let r;if(s.value.isBuyNow){const e={productId:s.value.products[0].productId,quantity:s.value.products[0].quantity,specs:s.value.products[0].specs||{}};r=await q(e)}else r=await B();if(r.data.code===0){const v={orderNo:r.data.data,amount:s.value.totalAmount,businessType:C.MALL,remarks:_.value};if(localStorage.setItem("payment_info",JSON.stringify(v)),s.value.products)try{await g.removeOrderedItems(s.value)||console.warn("部分购物车商品删除失败，但订单已创建成功")}catch(n){console.error("删除购物车商品时出错:",n)}localStorage.removeItem("checkout_order"),u.success("订单创建成功，即将跳转到支付页面"),setTimeout(()=>{p.push("/payment")},1e3)}else u.error(r.message||"创建订单失败")}catch(r){console.error("创建订单失败:",r),u.error("创建订单失败，请重试")}finally{m.value=!1}};return S(()=>{const r=localStorage.getItem("checkout_order");if(r)try{s.value=JSON.parse(r),console.log("订单信息:",s.value)}catch(e){console.error("解析订单信息失败",e),u.error("获取订单信息失败"),p.push("/cart")}else u.warning("没有待结算的订单"),p.push("/cart")}),(r,e)=>{const v=O,n=j,w=V;return s.value?(l(),c("div",T,[t("div",L,[e[2]||(e[2]=t("h2",null,"订单确认",-1)),d(v,{type:"text",onClick:x},{default:f(()=>e[1]||(e[1]=[k("返回购物车")])),_:1})]),t("div",M,[e[5]||(e[5]=t("h3",null,"商品信息",-1)),s.value.product?(l(),c("div",D,[d(n,{src:s.value.product.productImage,class:"product-image",fit:"cover"},null,8,["src"]),t("div",J,[t("div",U,o(s.value.product.productName),1),Object.keys(s.value.product.specs||{}).length>0?(l(),c("div",$," 规格："+o(Object.entries(s.value.product.specs).map(([a,h])=>`${h}`).join("、")),1)):i("",!0),t("div",z,"¥"+o((s.value.product.productPrice+s.value.product.priceAdjustment).toFixed(2)),1),t("div",Q,"x "+o(s.value.quantity),1)]),t("div",R,[e[3]||(e[3]=t("span",null,"小计：",-1)),t("span",Y,"¥"+o(s.value.totalAmount.toFixed(2)),1)])])):i("",!0),s.value.products?(l(),c("div",G,[(l(!0),c(F,null,A(s.value.products,(a,h)=>(l(),c("div",{key:h,class:"product-info"},[d(n,{src:a.productImage,class:"product-image",fit:"cover"},null,8,["src"]),t("div",H,[t("div",K,o(a.productName),1),Object.keys(a.specs||{}).length>0?(l(),c("div",W," 规格："+o(Object.entries(a.specs).map(([pt,N])=>`${N}`).join("、")),1)):i("",!0),t("div",X,"¥"+o((a.productPrice+a.priceAdjustment).toFixed(2)),1),t("div",Z,"x "+o(a.quantity),1)]),t("div",tt,[e[4]||(e[4]=t("span",null,"小计：",-1)),t("span",et,"¥"+o(((a.productPrice+a.priceAdjustment)*a.quantity).toFixed(2)),1)])]))),128))])):i("",!0)]),t("div",st,[e[6]||(e[6]=t("h3",null,"订单备注",-1)),d(w,{type:"textarea",rows:3,placeholder:"可以告诉我们您的特殊要求（选填）",modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),t("div",ot,[t("div",at,[e[7]||(e[7]=t("span",null,"商品总价：",-1)),t("span",null,"¥"+o(s.value.totalAmount.toFixed(2)),1)]),t("div",rt,[e[8]||(e[8]=t("span",null,"应付总额：",-1)),t("span",ct,"¥"+o(s.value.totalAmount.toFixed(2)),1)])]),t("div",lt,[t("div",nt,[e[9]||(e[9]=t("span",null,"应付总额：",-1)),t("span",ut,"¥"+o(s.value.totalAmount.toFixed(2)),1)]),d(v,{type:"primary",size:"large",onClick:I,loading:m.value},{default:f(()=>[k(o(m.value?"创建订单中...":"提交订单"),1)]),_:1},8,["loading"])])])):i("",!0)}}},gt=P(it,[["__scopeId","data-v-5f7ebdac"]]);export{gt as default};
