import{K as le,r as w,o as oe,q as f,l as t,j as s,F as u,w as l,v as ne,U as ie,a2 as re,E as p,i as d,n as b,y as de,ae as ue,ab as ce,Z as pe,P as N,Q as me,f as $,Y as ve,a6 as fe,s as _e,b2 as ge,b3 as be,b4 as ye,M as ke,ar as we,as as De,a1 as Ce,B as r,p as v,_ as Te,a0 as he,c as O}from"./index-CZU4bJ5v.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                *//* empty css                     *//* empty css                  *//* empty css                       */import{f as Ee,h as y,O as xe,a as $e,i as Re,j as Ve,d as ze}from"./venueOrder-DMbH4-nC.js";import{a as Ne}from"./venue-kQTGcyW_.js";/* empty css                       */import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"booking-management"},Oe={class:"page-header"},Ae={class:"header-content"},Pe={class:"page-title"},Se={class:"filter-section"},Le={class:"table-section"},Ue={class:"card-header"},Fe={class:"total-count"},Me={class:"time-slot"},Ye={class:"amount"},je={class:"create-time"},Ge={class:"action-buttons"},qe={class:"pagination-container"},Ke={key:0,class:"order-detail"},Qe={class:"detail-grid"},We={class:"detail-item"},Xe={class:"value"},Ze={class:"detail-item"},He={class:"value"},Je={class:"detail-item"},et={class:"value"},tt={class:"detail-item"},at={class:"value"},st={class:"detail-item"},lt={class:"value"},ot={class:"detail-item"},nt={class:"value"},it={class:"detail-item"},rt={class:"value"},dt={class:"detail-item"},ut={class:"value"},ct={class:"detail-item"},pt={class:"value amount"},mt={class:"detail-item"},vt={class:"value"},ft={key:0,class:"detail-item"},_t={class:"value"},gt={key:1,class:"detail-item"},bt={class:"value"},yt={key:2,class:"detail-item full-width"},kt={class:"value"},wt={key:3,class:"detail-item full-width"},Dt={class:"value"},Ct={key:4,class:"detail-item full-width"},Tt={class:"value"},ht={class:"dialog-footer"},Et={__name:"BookingReview",setup(xt){const c=le({venueId:"",startDate:"",endDate:"",status:""}),T=w(1),B=w(10),h=w(0),E=w(!1),x=w([]),A=w([]),D=w(!1),n=w(null),q=async()=>{try{const a=await Ne();a.data.code===0?A.value=a.data.data||[]:console.error("获取场地列表失败:",a.message)}catch(a){console.error("获取场地列表失败:",a)}},k=async()=>{E.value=!0;try{const a={page:T.value,size:B.value,...c};Object.keys(a).forEach(i=>{(a[i]===""||a[i]===null||a[i]===void 0)&&delete a[i]});const e=await Ee(a);if(e.data.code===0){const i=e.data.data.list||[];x.value=i.filter(_=>_.status!==y.PENDING_PAYMENT),h.value=x.value.length}else p.error(e.message||"获取订单列表失败"),x.value=[],h.value=0}catch(a){console.error("获取订单列表失败:",a),p.error("网络错误，获取订单列表失败"),x.value=[],h.value=0}finally{E.value=!1}},P=()=>{T.value=1,k()},K=()=>{c.venueId="",c.startDate="",c.endDate="",c.status="",P()},S=a=>$e[a]||"未知状态",L=a=>xe[a]||"info",U=a=>{O.confirm(`确定要完成用户 ${a.username} 在 ${a.reservationDate} ${a.startTime}-${a.endTime} 的 ${a.venueName} 预定吗？`,"完成订单确认",{confirmButtonText:"确定完成",cancelButtonText:"取消",type:"warning",center:!0,customClass:"custom-message-box"}).then(async()=>{try{const e=await Re(a.id);e.data.code===0?(p({type:"success",message:"订单已完成",duration:2e3}),k(),D.value=!1):p.error(e.message||"完成订单失败")}catch(e){console.error("完成订单失败:",e),p.error("完成订单失败")}}).catch(()=>{p({type:"info",message:"已取消操作",duration:2e3})})},R=(a,e)=>{const i=e?"批准":"拒绝";O.prompt(`确定要${i}用户 ${a.username} 的退款申请吗？`,`${i}退款申请`,{confirmButtonText:`确定${i}`,cancelButtonText:"取消",inputPlaceholder:"请输入管理员备注（可选）",inputType:"textarea",center:!0,customClass:"custom-message-box"}).then(async({value:_})=>{try{const C=await Ve(a.id,{approved:e,adminRemark:_||""});C.data.code===0?(p({type:"success",message:`已${i}退款申请`,duration:2e3}),k(),D.value=!1):p.error(C.message||`${i}退款申请失败`)}catch(C){console.error(`${i}退款申请失败:`,C),p.error(`${i}退款申请失败`)}}).catch(()=>{p({type:"info",message:"已取消操作",duration:2e3})})},Q=a=>{O.prompt(`确定要取消 ${a.username} 在 ${a.reservationDate} ${a.startTime}-${a.endTime} 的 ${a.venueName} 预定吗？`,"管理员取消订单",{confirmButtonText:"确定取消",cancelButtonText:"返回",inputPlaceholder:"请输入取消原因",inputType:"textarea",inputValidator:e=>!e||e.trim()===""?"请输入取消原因":!0,center:!0,customClass:"custom-message-box"}).then(async({value:e})=>{try{const i=await ze(a.id,{reason:e});i.data.code===0?(p({type:"success",message:"订单已取消",duration:2e3}),k(),D.value=!1):p.error(i.message||"取消订单失败")}catch(i){console.error("取消订单失败:",i),p.error("取消订单失败")}}).catch(()=>{p({type:"info",message:"已取消操作",duration:2e3})})},W=a=>{n.value=a,D.value=!0},X=a=>{B.value=a,T.value=1,k()},Z=a=>{T.value=a,k()},V=a=>a?new Date(a).toLocaleString("zh-CN"):"",F=a=>a.status===y.PAID,H=a=>a.status===y.PAID,M=a=>a.status===y.REFUNDING;return oe(()=>{k(),q()}),(a,e)=>{const i=ne,_=ve,C=pe,z=ce,Y=fe,m=_e,J=ue,j=ie,g=De,G=Ce,ee=we,te=he,ae=re,se=Te;return d(),f("div",Ie,[t("div",Oe,[t("div",Ae,[t("h1",Pe,[s(i,{class:"title-icon"},{default:l(()=>[s(b(de))]),_:1}),e[10]||(e[10]=u(" 预定管理 "))]),e[11]||(e[11]=t("p",{class:"page-description"},"管理场地预约订单，处理退款申请和订单完成",-1))])]),t("div",Se,[s(j,{class:"filter-card",shadow:"never"},{header:l(()=>e[12]||(e[12]=[t("div",{class:"card-header"},[t("span",{class:"card-title"},"筛选条件")],-1)])),default:l(()=>[s(J,{inline:!0,model:c,class:"filter-form"},{default:l(()=>[s(z,{label:"场地"},{default:l(()=>[s(C,{modelValue:c.venueId,"onUpdate:modelValue":e[0]||(e[0]=o=>c.venueId=o),placeholder:"请选择场地",size:"large",style:{width:"180px"},clearable:""},{default:l(()=>[(d(!0),f(N,null,me(A.value,o=>(d(),$(_,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(z,{label:"订单状态"},{default:l(()=>[s(C,{modelValue:c.status,"onUpdate:modelValue":e[1]||(e[1]=o=>c.status=o),placeholder:"请选择状态",size:"large",style:{width:"150px"},clearable:""},{default:l(()=>[s(_,{label:"已支付",value:b(y).PAID},null,8,["value"]),s(_,{label:"已完成",value:b(y).COMPLETED},null,8,["value"]),s(_,{label:"已取消",value:b(y).CANCELLED},null,8,["value"]),s(_,{label:"退款中",value:b(y).REFUNDING},null,8,["value"]),s(_,{label:"已退款",value:b(y).REFUNDED},null,8,["value"])]),_:1},8,["modelValue"])]),_:1}),s(z,{label:"预约日期"},{default:l(()=>[s(Y,{modelValue:c.startDate,"onUpdate:modelValue":e[2]||(e[2]=o=>c.startDate=o),type:"date",placeholder:"开始日期",style:{width:"140px"},"value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"]),e[13]||(e[13]=t("span",{class:"date-separator"},"至",-1)),s(Y,{modelValue:c.endDate,"onUpdate:modelValue":e[3]||(e[3]=o=>c.endDate=o),type:"date",placeholder:"结束日期",style:{width:"140px"},"value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),s(z,null,{default:l(()=>[s(m,{type:"primary",size:"large",onClick:P},{default:l(()=>[s(i,null,{default:l(()=>[s(b(ge))]),_:1}),e[14]||(e[14]=u(" 筛选 "))]),_:1}),s(m,{size:"large",onClick:K},{default:l(()=>[s(i,null,{default:l(()=>[s(b(be))]),_:1}),e[15]||(e[15]=u(" 重置 "))]),_:1}),s(m,{type:"success",size:"large",onClick:k,loading:E.value},{default:l(()=>[s(i,null,{default:l(()=>[s(b(ye))]),_:1}),e[16]||(e[16]=u(" 刷新 "))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),t("div",Le,[s(j,{class:"table-card",shadow:"never"},{header:l(()=>[t("div",Ue,[e[17]||(e[17]=t("span",{class:"card-title"},"订单列表",-1)),t("span",Fe,"共 "+r(h.value)+" 条记录",1)])]),default:l(()=>[ke((d(),$(ee,{data:x.value,style:{width:"100%"},"empty-text":E.value?"加载中...":"暂无数据",stripe:"","header-cell-style":{background:"#f8f9fa",color:"#606266",fontWeight:"bold"}},{default:l(()=>[s(g,{prop:"id",label:"订单ID",width:"80",fixed:""}),s(g,{prop:"orderNo",label:"订单号",width:"180","show-overflow-tooltip":""}),s(g,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(o=>[s(G,{type:L(o.row.status),size:"large"},{default:l(()=>[u(r(S(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),s(g,{prop:"username",label:"预定用户",width:"120","show-overflow-tooltip":""}),s(g,{prop:"venueName",label:"场地名称",width:"140","show-overflow-tooltip":""}),s(g,{prop:"reservationDate",label:"预约日期",width:"120",align:"center"}),s(g,{label:"时间段",width:"140",align:"center"},{default:l(o=>[t("span",Me,r(o.row.startTime)+"-"+r(o.row.endTime),1)]),_:1}),s(g,{label:"金额",width:"120",align:"right"},{default:l(o=>[t("span",Ye,"¥"+r(o.row.totalAmount),1)]),_:1}),s(g,{label:"创建时间","min-width":"160"},{default:l(o=>[t("span",je,r(V(o.row.createTime)),1)]),_:1}),s(g,{label:"操作",width:"300",fixed:"right",align:"left"},{default:l(o=>[t("div",Ge,[s(m,{size:"small",type:"info",onClick:I=>W(o.row)},{default:l(()=>e[18]||(e[18]=[u("详情")])),_:2},1032,["onClick"]),F(o.row)?(d(),$(m,{key:0,size:"small",type:"success",onClick:I=>U(o.row)},{default:l(()=>e[19]||(e[19]=[u(" 完成订单 ")])),_:2},1032,["onClick"])):v("",!0),M(o.row)?(d(),f(N,{key:1},[s(m,{size:"small",type:"success",onClick:I=>R(o.row,!0)},{default:l(()=>e[20]||(e[20]=[u(" 批准退款 ")])),_:2},1032,["onClick"]),s(m,{size:"small",type:"danger",onClick:I=>R(o.row,!1)},{default:l(()=>e[21]||(e[21]=[u(" 拒绝退款 ")])),_:2},1032,["onClick"])],64)):v("",!0)])]),_:1})]),_:1},8,["data","empty-text"])),[[se,E.value]]),t("div",qe,[s(te,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:h.value,"page-size":B.value,"page-sizes":[10,20,50,100],"current-page":T.value,onSizeChange:X,onCurrentChange:Z},null,8,["total","page-size","current-page"])])]),_:1})]),s(ae,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=o=>D.value=o),title:"订单详情",width:"600px","close-on-click-modal":!1},{footer:l(()=>[t("div",ht,[s(m,{onClick:e[4]||(e[4]=o=>D.value=!1)},{default:l(()=>e[37]||(e[37]=[u("关闭")])),_:1}),n.value?(d(),f(N,{key:0},[F(n.value)?(d(),$(m,{key:0,type:"success",onClick:e[5]||(e[5]=o=>U(n.value))},{default:l(()=>e[38]||(e[38]=[u(" 完成订单 ")])),_:1})):v("",!0),M(n.value)?(d(),f(N,{key:1},[s(m,{type:"success",onClick:e[6]||(e[6]=o=>R(n.value,!0))},{default:l(()=>e[39]||(e[39]=[u(" 批准退款 ")])),_:1}),s(m,{type:"danger",onClick:e[7]||(e[7]=o=>R(n.value,!1))},{default:l(()=>e[40]||(e[40]=[u(" 拒绝退款 ")])),_:1})],64)):v("",!0),H(n.value)?(d(),$(m,{key:2,type:"warning",onClick:e[8]||(e[8]=o=>Q(n.value))},{default:l(()=>e[41]||(e[41]=[u(" 取消订单 ")])),_:1})):v("",!0)],64)):v("",!0)])]),default:l(()=>[n.value?(d(),f("div",Ke,[t("div",Qe,[t("div",We,[e[22]||(e[22]=t("span",{class:"label"},"订单ID",-1)),t("span",Xe,r(n.value.id),1)]),t("div",Ze,[e[23]||(e[23]=t("span",{class:"label"},"订单号",-1)),t("span",He,r(n.value.orderNo),1)]),t("div",Je,[e[24]||(e[24]=t("span",{class:"label"},"订单状态",-1)),t("span",et,[s(G,{type:L(n.value.status),size:"large"},{default:l(()=>[u(r(S(n.value.status)),1)]),_:1},8,["type"])])]),t("div",tt,[e[25]||(e[25]=t("span",{class:"label"},"预定用户",-1)),t("span",at,r(n.value.username),1)]),t("div",st,[e[26]||(e[26]=t("span",{class:"label"},"用户手机",-1)),t("span",lt,r(n.value.userPhone||"未提供"),1)]),t("div",ot,[e[27]||(e[27]=t("span",{class:"label"},"场地名称",-1)),t("span",nt,r(n.value.venueName),1)]),t("div",it,[e[28]||(e[28]=t("span",{class:"label"},"预约日期",-1)),t("span",rt,r(n.value.reservationDate),1)]),t("div",dt,[e[29]||(e[29]=t("span",{class:"label"},"时间段",-1)),t("span",ut,r(n.value.startTime)+"-"+r(n.value.endTime),1)]),t("div",ct,[e[30]||(e[30]=t("span",{class:"label"},"订单金额",-1)),t("span",pt,"¥"+r(n.value.totalAmount),1)]),t("div",mt,[e[31]||(e[31]=t("span",{class:"label"},"创建时间",-1)),t("span",vt,r(V(n.value.createTime)),1)]),n.value.payTime?(d(),f("div",ft,[e[32]||(e[32]=t("span",{class:"label"},"支付时间",-1)),t("span",_t,r(V(n.value.payTime)),1)])):v("",!0),n.value.cancelTime?(d(),f("div",gt,[e[33]||(e[33]=t("span",{class:"label"},"取消时间",-1)),t("span",bt,r(V(n.value.cancelTime)),1)])):v("",!0),n.value.cancelReason?(d(),f("div",yt,[e[34]||(e[34]=t("span",{class:"label"},"取消原因",-1)),t("span",kt,r(n.value.cancelReason),1)])):v("",!0),n.value.refundReason?(d(),f("div",wt,[e[35]||(e[35]=t("span",{class:"label"},"退款原因",-1)),t("span",Dt,r(n.value.refundReason),1)])):v("",!0),n.value.adminRemark?(d(),f("div",Ct,[e[36]||(e[36]=t("span",{class:"label"},"管理员备注",-1)),t("span",Tt,r(n.value.adminRemark),1)])):v("",!0)])])):v("",!0)]),_:1},8,["modelValue"])])}}},Qt=Be(Et,[["__scopeId","data-v-34a2a196"]]);export{Qt as default};
