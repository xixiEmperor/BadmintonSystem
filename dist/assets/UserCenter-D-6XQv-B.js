import{r as b,u as S,K as z,o as P,q as h,l as _,j as t,w as s,U as q,E as v,al as N,b as O,i as w,ae as K,ab as Z,aI as $,ac as J,n as y,z as Q,aJ as T,Z as Y,P as G,Q as H,Y as W,a6 as X,y as ee,aK as ae,s as te,F as oe,aL as re,aM as le}from"./index-CHTw6ThQ.js";/* empty css                *//* empty css                     *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css               *//* empty css                  *//* empty css                    */import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"user-center-container"},de=["src"],ue={key:1,src:"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png",class:"avatar",alt:"默认头像"},ie={class:"form-section"},ce={class:"form-section"},pe={__name:"UserCenter",setup(me){const R=O(),I=N(),V=b("/"),g=S(),o=z({username:"",nickname:"",phone:"",bio:"",gender:"",birthday:"",location:"",avatar:""}),E=b(null),x=b(!1),F=[{value:"male",label:"男"},{value:"female",label:"女"},{value:"other",label:"其他"}],U=b(""),C={nickname:[{pattern:/^[\u4e00-\u9fa5a-zA-Z]+$/,message:"名称只能由英文字母，汉字组成",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},k=a=>{const e=a.type==="image/jpeg"||a.type==="image/png"||a.type==="image/jpg",c=a.size/1024/1024<10;return e?c?!0:(v.error("头像大小不能超过 10MB!"),!1):(v.error("文件格式不支持，请上传jpg、png或jpeg格式图片"),!1)},M=(a,e=.8)=>new Promise(c=>{const l=new FileReader;l.readAsDataURL(a),l.onload=n=>{const p=new Image;p.src=n.target.result,p.onload=()=>{const m=document.createElement("canvas"),u=m.getContext("2d");let i=p.width,d=p.height;const f=800;i>d&&i>f?(d=Math.round(d*f/i),i=f):d>f&&(i=Math.round(i*f/d),d=f),m.width=i,m.height=d,u.clearRect(0,0,i,d),u.drawImage(p,0,0,i,d),m.toBlob(r=>{const L=new File([r],a.name,{type:a.type,lastModified:Date.now()});c(L)},a.type,e)}}}),A=async(a,e)=>{var c,l;if(e.raw)try{const n=await M(e.raw),p=new FormData;p.append("file",n);const m=new FileReader;m.readAsDataURL(n),m.onload=()=>{U.value=m.result};const u=await le(p);if(u.data.code===0){U.value=u.data.data.avatarUrl,o.avatar=u.data.data.avatarUrl;const d={...g.userinfo,avatar:u.data.data.avatarUrl};g.setUserinfo(d),window.dispatchEvent(new CustomEvent("user-avatar-updated",{detail:{avatarUrl:u.data.data.avatarUrl}})),v.success(u.data.message||"上传成功")}else v.error(u.data.message||"上传失败")}catch(n){console.error("头像上传失败:",n),v.error(((l=(c=n.response)==null?void 0:c.data)==null?void 0:l.message)||"头像上传失败")}},j=a=>{a.raw&&k(a.raw)&&A(null,a)},B=async()=>{try{x.value=!0,await E.value.validate();const a=await re(o);v.success(a.data.msg);const c={...g.userinfo,...a.data.data};g.setUserinfo(c),R.push(V.value)}catch(a){v.error(a.response.data.message)}finally{x.value=!1}},D=()=>{const a=g.userinfo;if(a)try{Object.keys(o).forEach(e=>{a[e]&&(o[e]=a[e])}),a.avatar&&(U.value=a.avatar)}catch(e){v.error(e.response.data.message)}if(I.query.from)V.value=I.query.from;else if(document.referrer&&document.referrer.includes(window.location.origin)){const e=new URL(document.referrer);V.value=e.pathname+e.search}};return P(()=>{D()}),(a,e)=>{const c=$,l=Z,n=J,p=W,m=Y,u=X,i=te,d=K,f=q;return w(),h("div",ne,[e[11]||(e[11]=_("h2",null,"个人中心",-1)),t(f,{class:"user-center-card"},{default:s(()=>[t(d,{ref_key:"userFormRef",ref:E,model:o,rules:C,"label-position":"top",class:"user-form"},{default:s(()=>[t(l,{class:"avatar-uploader-container"},{default:s(()=>[t(c,{class:"avatar-uploader","show-file-list":!1,"on-change":j,"before-upload":k,"auto-upload":!1,name:"file"},{default:s(()=>[U.value?(w(),h("img",{key:0,src:U.value,class:"avatar"},null,8,de)):(w(),h("img",ue)),e[7]||(e[7]=_("div",{class:"avatar-hover-text"},"点击更换头像",-1))]),_:1})]),_:1}),_("div",ie,[e[8]||(e[8]=_("h3",null,"基本信息",-1)),t(l,{label:"账号"},{default:s(()=>[t(n,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=r=>o.username=r),disabled:"",placeholder:"userinfo.username"},null,8,["modelValue"])]),_:1}),t(l,{label:"昵称",prop:"nickname"},{default:s(()=>[t(n,{modelValue:o.nickname,"onUpdate:modelValue":e[1]||(e[1]=r=>o.nickname=r),placeholder:"请输入昵称","prefix-icon":y(Q)},null,8,["modelValue","prefix-icon"])]),_:1}),t(l,{label:"手机号码",prop:"phone"},{default:s(()=>[t(n,{modelValue:o.phone,"onUpdate:modelValue":e[2]||(e[2]=r=>o.phone=r),placeholder:"请输入手机号码","prefix-icon":y(T)},null,8,["modelValue","prefix-icon"])]),_:1}),t(l,{label:"个人简介"},{default:s(()=>[t(n,{modelValue:o.bio,"onUpdate:modelValue":e[3]||(e[3]=r=>o.bio=r),type:"textarea",placeholder:"请输入个人简介",rows:4},null,8,["modelValue"])]),_:1})]),_("div",ce,[e[9]||(e[9]=_("h3",null,"更多信息",-1)),t(l,{label:"性别"},{default:s(()=>[t(m,{modelValue:o.gender,"onUpdate:modelValue":e[4]||(e[4]=r=>o.gender=r),placeholder:"请选择性别",style:{width:"100%"}},{default:s(()=>[(w(),h(G,null,H(F,r=>t(p,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(l,{label:"生日"},{default:s(()=>[t(u,{modelValue:o.birthday,"onUpdate:modelValue":e[5]||(e[5]=r=>o.birthday=r),type:"date",placeholder:"请选择生日",style:{width:"100%"},"prefix-icon":y(ee)},null,8,["modelValue","prefix-icon"])]),_:1}),t(l,{label:"所在地"},{default:s(()=>[t(n,{modelValue:o.location,"onUpdate:modelValue":e[6]||(e[6]=r=>o.location=r),placeholder:"请输入所在地","prefix-icon":y(ae)},null,8,["modelValue","prefix-icon"])]),_:1})]),t(l,null,{default:s(()=>[t(i,{type:"primary",onClick:B,loading:x.value,class:"save-btn"},{default:s(()=>e[10]||(e[10]=[oe("保存修改")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}},Ie=se(pe,[["__scopeId","data-v-1c0e85da"]]);export{Ie as default};
