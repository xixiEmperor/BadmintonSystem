import{ay as Y,r as O,E as L,d as Z,o as ee,q as p,l as o,p as P,j as i,w as y,an as te,n as E,ag as se,$ as oe,P as x,Q as A,a0 as ae,b as ne,i as r,aq as re,s as ie,F as N,B as m,a1 as le,m as ce,f as S,c as z}from"./index-CHTw6ThQ.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                  *//* empty css                         *//* empty css                    */import{f as de,d as ue,O as a}from"./pay-BK3Jx5pZ.js";/* empty css                       *//* empty css                   */import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me=Y("order",()=>{const k=O([]),_=O(!1),l=O(0),h=O(null);async function d(v=1,c=5,C=null){if(!_.value){_.value=!0;try{const u=await de({pageNum:v,pageSize:c,status:C});if(u.data.code===0)k.value=u.data.data.list||[],l.value=u.data.data.total||0;else throw new Error(u.data.message||"获取订单列表失败")}catch(u){console.error("获取订单列表失败:",u),L.error("获取订单列表失败")}finally{_.value=!1}}}async function f(v){try{const c=await ue(v);if(c.data.code===0){const C=k.value.findIndex(u=>u.orderNo===v);return C!==-1&&(k.value[C].status=a.CANCELLED),L.success(c.data.msg||"订单取消成功"),!0}else return L.error(c.data.msg||"取消订单失败"),!1}catch(c){return console.error("取消订单失败:",c),L.error("取消订单失败"),!1}}function T(v){return k.value.find(c=>c.orderNo===v)}return{orderList:k,loading:_,fetchOrderList:d,cancelOrder:f,getOrderByNo:T,total:l,status:h}},{persist:!0}),_e={class:"order-list-container"},fe={class:"order-header"},ve={class:"order-tabs"},ge={key:0,class:"loading-container"},ye={key:1,class:"empty-container"},he={key:2,class:"order-list"},Ce={class:"order-header-info"},Oe={class:"order-info"},ke={class:"order-no"},Ee={class:"order-time"},Ne={class:"order-status"},Le={class:"order-content"},De={class:"order-products"},Pe=["onClick"],Te={class:"product-details"},Ie={class:"product-name"},Se={key:0,class:"product-specs"},be={class:"product-price"},we={class:"product-quantity"},xe={class:"order-footer"},Ae={class:"order-amount"},ze={class:"total-price"},Be={class:"order-actions"},Ue={key:3,class:"pagination-container"},Ve={__name:"OrderListView",setup(k){const _=ne(),l=me(),h=O("all"),d=O(1),f=O(5),{loading:T,cancelOrder:v,refreshOrders:c}=l,C=Z(()=>l.total),u=e=>{h.value=e,d.value=1,l.fetchOrderList(d.value,f.value,a[e])},B=e=>{f.value=e,d.value=1,l.fetchOrderList(d.value,f.value,a[h.value])},U=e=>{d.value=e,l.fetchOrderList(d.value,f.value,a[h.value])},b=e=>{_.push(`/order-detail/${e}`)},V=e=>{const t={orderNo:e.orderNo,amount:e.totalPrice,businessType:"SHOP_ORDER"};localStorage.setItem("payment_info",JSON.stringify(t)),_.push("/payment")},$=e=>{z.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await v(e)}).catch(()=>{})},j=e=>{z.confirm("确定已收到商品吗？","确认收货",{confirmButtonText:"确认收货",cancelButtonText:"取消",type:"info"}).then(async()=>{try{console.log("确认收货订单号:",e),L.success("确认收货成功"),await c()}catch(t){console.error("确认收货失败:",t),L.error("确认收货失败")}}).catch(()=>{})},R=()=>{_.push("/shop")},q=e=>{switch(e){case a.UNPAID:return"warning";case a.PAID:return"success";case a.CANCELLED:return"danger";default:return"info"}},F=e=>{switch(e){case a.UNPAID:return"待支付";case a.PAID:return"已支付";case a.CANCELLED:return"已取消";case a.COMPLETED:return"已完成";default:return"未知状态"}},M=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",H=e=>{if(!e||e===null)return!1;if(typeof e=="object"){const t=Object.entries(e);return t.length>0&&t.some(([,g])=>g!=null&&g!=="")}return!1};return ee(()=>{l.fetchOrderList()}),(e,t)=>{const g=re,J=te,Q=se,D=ie,G=oe,K=le,W=ce,X=ae;return r(),p("div",_e,[o("div",fe,[t[3]||(t[3]=o("h2",null,"我的订单",-1)),o("div",ve,[i(J,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),onTabChange:u},{default:y(()=>[i(g,{label:"全部订单",name:"all"}),i(g,{label:"待支付",name:"UNPAID"}),i(g,{label:"已支付",name:"PAID"}),i(g,{label:"已取消",name:"CANCELLED"})]),_:1},8,["modelValue"])])]),E(T)?(r(),p("div",ge,[i(Q,{rows:3,animated:""})])):E(l).orderList.length===0?(r(),p("div",ye,[i(G,{description:"暂无订单数据"},{default:y(()=>[i(D,{type:"primary",onClick:R},{default:y(()=>t[4]||(t[4]=[N("去购物")])),_:1})]),_:1})])):(r(),p("div",he,[(r(!0),p(x,null,A(E(l).orderList,s=>(r(),p("div",{key:s.orderNo,class:"order-item"},[o("div",Ce,[o("div",Oe,[o("span",ke,"订单号："+m(s.orderNo),1),o("span",Ee,m(M(s.createTime)),1)]),o("div",Ne,[i(K,{type:q(s.status)},{default:y(()=>[N(m(F(s.status)),1)]),_:2},1032,["type"])])]),o("div",Le,[o("div",De,[(r(!0),p(x,null,A(s.orderItemList,(n,I)=>(r(),p("div",{key:I,class:"product-item",onClick:w=>b(s.orderNo)},[i(W,{src:n.productImage,class:"product-image",fit:"cover"},null,8,["src"]),o("div",Te,[o("div",Ie,m(n.productName),1),H(n.specs)?(r(),p("div",Se," 规格："+m(Object.entries(n.specs).map(([,w])=>`${w}`).join("、")),1)):P("",!0),o("div",be,"¥"+m((n.currentUnitPrice+n.priceAdjustment).toFixed(2)),1)]),o("div",we,"x"+m(n.quantity),1)],8,Pe))),128))]),o("div",xe,[o("div",Ae,[o("span",null,"共"+m(s.orderItemList.reduce((n,I)=>n+I.quantity,0))+"件商品，合计：",1),o("span",ze,"¥"+m(s.totalPrice.toFixed(2)),1)]),o("div",Be,[i(D,{size:"small",onClick:n=>b(s.orderNo)},{default:y(()=>t[5]||(t[5]=[N(" 查看详情 ")])),_:2},1032,["onClick"]),s.status===E(a).UNPAID?(r(),S(D,{key:0,type:"primary",size:"small",onClick:n=>V(s)},{default:y(()=>t[6]||(t[6]=[N(" 立即支付 ")])),_:2},1032,["onClick"])):P("",!0),s.status===E(a).UNPAID?(r(),S(D,{key:1,type:"danger",size:"small",onClick:n=>$(s.orderNo)},{default:y(()=>t[7]||(t[7]=[N(" 取消订单 ")])),_:2},1032,["onClick"])):P("",!0),s.status===E(a).PAID?(r(),S(D,{key:2,type:"success",size:"small",onClick:n=>j(s.orderNo)},{default:y(()=>t[8]||(t[8]=[N(" 确认收货 ")])),_:2},1032,["onClick"])):P("",!0)])])])]))),128))])),C.value>0?(r(),p("div",Ue,[i(X,{"current-page":d.value,"onUpdate:currentPage":t[1]||(t[1]=s=>d.value=s),"page-size":f.value,"onUpdate:pageSize":t[2]||(t[2]=s=>f.value=s),"page-sizes":[5,10,15,20],total:C.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:U},null,8,["current-page","page-size","total"])])):P("",!0)])}}},et=pe(Ve,[["__scopeId","data-v-c13f4ba5"]]);export{et as default};
