import{r as $,o as T,q as y,l as n,j as a,f as h,p as k,w as l,n as c,a8 as F,s as z,ag as M,$ as O,ar as Q,B as i,b as U,i as d,F as w,as as J,at as L,m as D,au as R,av as G,aw as H,c as v}from"./index-CHTw6ThQ.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                         *//* empty css                  */import{u as K}from"./cart-_Tla4ces.js";/* empty css                       *//* empty css                 *//* empty css                   */import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"cart-container"},Y={class:"cart-header"},Z={class:"cart-actions"},tt={key:0},et={key:1,class:"empty-cart"},ot={key:2,class:"cart-content"},at={class:"product-info"},st={class:"product-details"},nt={key:0,class:"product-name"},lt={key:1,class:"product-name"},rt={class:"product-price"},ct={class:"price"},it={class:"quantity-control"},dt={class:"quantity"},ut={class:"subtotal"},mt={class:"action-buttons"},_t={class:"cart-footer"},pt={class:"total-amount"},yt={class:"total-price"},wt={__name:"CartView",setup(ft){const C=U(),s=K(),m=$(!1),b=()=>{m.value=!m.value},I=async o=>{await s.increaseQuantity(o)},S=async o=>{await s.decreaseQuantity(o)},x=o=>{v.confirm(`确定要从购物车中移除 ${o.productName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await s.removeFromCart(o)}).catch(()=>{})},A=async o=>{await s.toggleSelectItem(o)},V=async()=>{await s.toggleSelectAll()},E=()=>{v.confirm("确定要清空购物车吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await s.clearCart()}).catch(()=>{})},P=()=>{const o=s.getSelectedItems();if(o.length===0){v.alert("请至少选择一件商品进行结算！","提示");return}let e=0;const f={products:o.map(_=>{const g=_.productPrice+(_.priceAdjustment||0),u=g*_.quantity;return e+=u,{..._,actualPrice:g}}),totalAmount:e};localStorage.setItem("checkout_order",JSON.stringify(f)),C.push("/checkout")},B=o=>{const e=o.productPrice+(o.priceAdjustment||0),r=e*o.quantity,f={product:{...o,actualPrice:e},totalAmount:r};localStorage.setItem("checkout_order",JSON.stringify(f)),C.push("/checkout")};return T(async()=>{s.resetLoadingState();try{await s.fetchCartList()}catch(o){console.error("获取购物车数据失败:",o)}}),(o,e)=>{const r=z,f=M,_=O,g=L,u=J,N=D,j=Q;return d(),y("div",X,[n("div",Y,[e[3]||(e[3]=n("h2",null,"我的购物车",-1)),n("div",Z,[a(r,{type:"primary",icon:c(F),onClick:b},{default:l(()=>[w(i(m.value?"完成":"编辑"),1)]),_:1},8,["icon"]),c(s).cartItems.length>0?(d(),h(r,{key:0,type:"danger",onClick:E},{default:l(()=>e[2]||(e[2]=[w(" 清空购物车 ")])),_:1})):k("",!0)])]),c(s).loading?(d(),y("div",tt,[a(f,{rows:5,animated:""})])):c(s).cartItems.length===0?(d(),y("div",et,[a(_,{description:"购物车是空的，快去添加喜欢的商品吧！"},{default:l(()=>[a(r,{type:"primary",onClick:e[0]||(e[0]=t=>o.$router.push("/shop"))},{default:l(()=>e[4]||(e[4]=[w("去购物")])),_:1})]),_:1})])):(d(),y("div",ot,[a(j,{data:c(s).cartItems,style:{width:"100%"}},{default:l(()=>[a(u,{width:"55",align:"center"},{header:l(()=>[a(g,{modelValue:c(s).isAllSelected,"onUpdate:modelValue":e[1]||(e[1]=t=>c(s).isAllSelected=t),onChange:V},null,8,["modelValue"])]),default:l(t=>[a(g,{modelValue:t.row.selected,"onUpdate:modelValue":p=>t.row.selected=p,onChange:()=>A(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(u,{label:"商品","min-width":"300"},{default:l(t=>[n("div",at,[a(N,{src:t.row.productImage,fit:"cover",class:"product-image"},null,8,["src"]),n("div",st,[Object.keys(t.row.specs||{}).length>0?(d(),y("div",nt,i(t.row.productName)+" ("+i(Object.entries(t.row.specs).map(([p,q])=>`${q}`).join("、"))+") ",1)):(d(),y("div",lt,i(t.row.productName),1)),n("div",rt,"¥"+i(t.row.productPrice+t.row.priceAdjustment),1)])])]),_:1}),a(u,{label:"单价",width:"120",align:"center"},{default:l(t=>[n("span",ct,"¥"+i(t.row.productPrice+t.row.priceAdjustment),1)]),_:1}),a(u,{label:"数量",width:"180",align:"center"},{default:l(t=>[n("div",it,[a(r,{icon:c(R),circle:"",size:"small",onClick:p=>S(t.row),disabled:t.row.quantity<=1},null,8,["icon","onClick","disabled"]),n("span",dt,i(t.row.quantity),1),a(r,{icon:c(G),circle:"",size:"small",onClick:p=>I(t.row),disabled:t.row.quantity>=t.row.stock},null,8,["icon","onClick","disabled"])])]),_:1}),a(u,{label:"小计",width:"150",align:"center"},{default:l(t=>[n("span",ut,"¥"+i(((t.row.productPrice+t.row.priceAdjustment)*t.row.quantity).toFixed(2)),1)]),_:1}),a(u,{label:"操作",width:"180",align:"center"},{default:l(t=>[n("div",mt,[m.value?(d(),h(r,{key:0,type:"danger",icon:c(H),size:"small",onClick:p=>x(t.row)},{default:l(()=>e[5]||(e[5]=[w(" 删除 ")])),_:2},1032,["icon","onClick"])):k("",!0),m.value?k("",!0):(d(),h(r,{key:1,type:"primary",size:"small",onClick:p=>B(t.row)},{default:l(()=>e[6]||(e[6]=[w(" 立即购买 ")])),_:2},1032,["onClick"]))])]),_:1})]),_:1},8,["data"]),n("div",_t,[n("div",pt,[e[7]||(e[7]=n("span",null,"总计:",-1)),n("span",yt,"¥"+i(c(s).totalPrice.toFixed(2)),1)]),a(r,{type:"primary",size:"large",onClick:P,disabled:m.value},{default:l(()=>e[8]||(e[8]=[w(" 结算 ")])),_:1},8,["disabled"])])]))])}}},jt=W(wt,[["__scopeId","data-v-92b21634"]]);export{jt as default};
