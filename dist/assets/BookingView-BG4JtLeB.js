import{r as k,K as Ce,o as fe,q as v,l as e,M as ye,p as Q,j as o,w as n,Y as be,Z as he,_ as ke,f as te,P as J,Q as X,$ as Ve,a0 as Ee,a1 as He,F as G,B as g,a2 as ve,E as I,a3 as Me,i,a4 as Ne,O as pe,s as ce,a5 as Oe,d as ne,L as $e,a6 as De,a7 as ge,b as ze,n as K,a8 as se,v as Pe,a9 as Re,y as Te,aa as Ye,ab as Be,ac as Ie,ad as Fe,ae as Ue,af as Le,ag as Ae,ah as qe,ai as je,U as We}from"./index-CZU4bJ5v.js";/* empty css                  *//* empty css                   *//* empty css               *//* empty css                *//* empty css                         *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                         */import{g as Ze,a as Ke}from"./booking-DJVTAb69.js";import{f as Qe}from"./format-BoKD-3ja.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as Ge,a as Je,b as Xe}from"./venue-kQTGcyW_.js";/* empty css                     *//* empty css                 */import{c as et}from"./venueOrder-DMbH4-nC.js";const tt={class:"notice-list-page"},at={class:"filter-container"},st={class:"notice-carousel-container"},ot={class:"notice-header"},lt={class:"notice-title"},nt={class:"notice-meta"},it={class:"notice-time"},rt={class:"notice-content"},dt={class:"notice-footer"},ct={key:1,class:"empty-state"},ut={key:0,class:"notice-grid"},mt={class:"notice-grid-container"},pt=["onClick"],vt={class:"grid-item-header"},_t={class:"grid-item-title"},gt={class:"grid-item-time"},ft={key:1,class:"pagination-container"},yt={class:"notice-detail"},bt={class:"detail-meta"},ht={class:"detail-time"},kt={class:"detail-content"},$t={__name:"NoticeList",setup(oe){const Z=k(null),N=k(!1),d=k(1),j=k(5),F=k(0),S=k([]),y=k(!1),E=Ce({id:"",title:"",content:"",type:1,publishTime:""}),O=c=>({1:"",2:"warning"})[c]||"",D=c=>({1:"普通通知",2:"重要通知"})[c]||"未知",m=c=>Qe(c,"YYYY-MM-DD HH:mm"),b=(c,u=100)=>c?c.length>u?c.substring(0,u)+"...":c:"",f=async()=>{try{N.value=!0;const c=await Ze({pageNum:d.value,pageSize:j.value,type:Z.value});c.data.code===0?(S.value=c.data.data.list,F.value=c.data.data.total):I.error(c.data.msg||"获取通知列表失败")}catch(c){console.error("获取通知列表失败:",c),I.error("获取通知列表失败")}finally{N.value=!1}},s=()=>{d.value=1,f()},T=c=>{d.value=c,f()},A=c=>{j.value=c,d.value=1,f()},U=async c=>{try{const u=await Ke(c.id);if(u.data.code===0){const B=u.data.data;Object.assign(E,B),y.value=!0}else I.error(u.data.msg||"获取通知详情失败")}catch(u){console.error("获取通知详情失败:",u),I.error("获取通知详情失败")}};return fe(()=>{f()}),(c,u)=>{const B=be,p=he,l=He,_=ce,z=Ne,P=Me,q=Ve,w=Ee,L=ve,ie=ke;return i(),v("div",tt,[u[4]||(u[4]=e("h2",{class:"page-title"},"通知公告",-1)),e("div",at,[o(p,{modelValue:Z.value,"onUpdate:modelValue":u[0]||(u[0]=$=>Z.value=$),placeholder:"选择通知类型",clearable:"",onChange:s},{default:n(()=>[o(B,{label:"全部通知",value:null}),o(B,{label:"普通通知",value:1}),o(B,{label:"重要通知",value:2})]),_:1},8,["modelValue"])]),ye((i(),v("div",st,[S.value.length>0?(i(),te(P,{key:0,height:"300px",autoplay:!0,interval:5e3,"indicator-position":"outside",arrow:"hover",type:"card"},{default:n(()=>[(i(!0),v(J,null,X(S.value,$=>(i(),te(z,{key:$.id,onClick:le=>U($)},{default:n(()=>[e("div",{class:pe(["notice-card",{important:$.type===2}])},[e("div",ot,[e("h3",lt,g($.title),1),e("div",nt,[o(l,{type:O($.type),size:"small"},{default:n(()=>[G(g(D($.type)),1)]),_:2},1032,["type"]),e("span",it,g(m($.publishTime)),1)])]),e("div",rt,g(b($.content,200)),1),e("div",dt,[o(_,{type:"primary",size:"small",onClick:Oe(le=>U($),["stop"])},{default:n(()=>u[2]||(u[2]=[G(" 查看详情 ")])),_:2},1032,["onClick"])])],2)]),_:2},1032,["onClick"]))),128))]),_:1})):Q("",!0),!N.value&&S.value.length===0?(i(),v("div",ct,[o(q,{description:"暂无通知"})])):Q("",!0)])),[[ie,N.value]]),S.value.length>0?(i(),v("div",ut,[u[3]||(u[3]=e("h3",{class:"grid-title"},"所有通知",-1)),e("div",mt,[(i(!0),v(J,null,X(S.value,$=>(i(),v("div",{key:`grid-${$.id}`,class:pe(["notice-grid-item",{important:$.type===2}]),onClick:le=>U($)},[e("div",vt,[e("span",_t,g($.title),1),o(l,{type:O($.type),size:"small"},{default:n(()=>[G(g(D($.type)),1)]),_:2},1032,["type"])]),e("div",gt,g(m($.publishTime)),1)],10,pt))),128))])])):Q("",!0),F.value>0?(i(),v("div",ft,[o(w,{background:"","hide-on-single-page":!1,layout:"total, sizes, prev, pager, next",total:F.value,"page-size":j.value,"page-sizes":[5,8,10],"current-page":d.value,onCurrentChange:T,onSizeChange:A},null,8,["total","page-size","current-page"])])):Q("",!0),o(L,{modelValue:y.value,"onUpdate:modelValue":u[1]||(u[1]=$=>y.value=$),title:E.title,width:"60%"},{default:n(()=>[e("div",yt,[e("div",bt,[o(l,{type:O(E.type)},{default:n(()=>[G(g(D(E.type)),1)]),_:1},8,["type"]),e("span",ht,"发布时间："+g(m(E.publishTime)),1)]),e("div",kt,g(E.content),1)])]),_:1},8,["modelValue","title"])])}}},Dt=ue($t,[["__scopeId","data-v-8775d99f"]]),Tt={class:"matrix-container"},xt={class:"date-selector"},St={class:"date-info"},wt={key:0,class:"workday-info"},Ct={key:1,class:"weekend-info"},Vt={class:"legend"},Et={class:"legend-text"},Ht={class:"matrix-table"},Mt={class:"status-matrix"},Nt={class:"venue-name"},Ot=["onClick","title"],zt={class:"dialog-footer"},Pt={__name:"VenueStatusMatrix",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(oe,{emit:Z}){const N=oe,d=ne({get:()=>N.visible});$e(()=>N.visible,p=>{p&&s()},{immediate:!0});const j=Z,F=()=>{j("close")},S=k(!1),y=k({}),E=k(new Date),O=k([]),D=k([]),m={1:"#67c23a",2:"#909399",3:"#f56c6c",4:"#e6a23c"},b={1:"空闲中",2:"使用中",3:"已预约",4:"不开放"},f=p=>{const l=p.getFullYear(),_=String(p.getMonth()+1).padStart(2,"0"),z=String(p.getDate()).padStart(2,"0");return`${l}-${_}-${z}`},s=async()=>{if(N.visible){S.value=!0;try{const p=f(E.value),l=await Ge({date:p});l.data.code===0&&(y.value=l.data.data.statusMatrix||{},D.value=l.data.data.venues||[],O.value=l.data.data.timeSlots||[])}catch(p){console.error("获取场地状态矩阵失败:",p),I.error("获取场地状态矩阵失败")}finally{S.value=!1}}},T=p=>{const l=p.getDay();return l>=1&&l<=5},A=p=>{const l=new Date;l.setHours(0,0,0,0);const _=new Date(l);_.setDate(_.getDate()+1);const z=new Date(p);return z.setHours(0,0,0,0),!(z.getTime()===l.getTime()||z.getTime()===_.getTime())},U=(p,l)=>{const _=y.value[p];return!_||!_[l]?1:_[l].status},c=(p,l)=>{const _=U(p,l);return{backgroundColor:m[_],color:"#fff",textAlign:"center",padding:"8px 4px",fontSize:"12px",cursor:"pointer",transition:"all 0.3s"}},u=(p,l)=>{const _=y.value[p.id];if(!_||!_[l])return;const z=_[l],P=z.status;let q="";P!==1?q=`${p.name} ${l} - ${b[P]} - ${z.reason}`:q=`${p.name} ${l} - ${b[P]}`,P===1?I.success(q):P===2?I.warning(q):P===3?I.error(q):P===4&&I.warning(q)},B=()=>{s()};return(p,l)=>{const _=De,z=ce,P=ve,q=ke;return i(),te(P,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=w=>d.value=w),title:"场地使用情况表",width:"90%","close-on-click-modal":!1,onClose:F,class:"venue-matrix-dialog"},{footer:n(()=>[e("div",zt,[o(z,{onClick:F},{default:n(()=>l[4]||(l[4]=[G("关闭")])),_:1}),o(z,{type:"primary",onClick:s},{default:n(()=>l[5]||(l[5]=[G("刷新数据")])),_:1})])]),default:n(()=>[e("div",Tt,[e("div",xt,[o(_,{modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=w=>E.value=w),type:"date",placeholder:"选择查询日期",format:"YYYY年MM月DD日",onChange:B,"disabled-date":A},null,8,["modelValue"]),e("div",St,[T(E.value)?(i(),v("span",wt," 工作日：白天场地用于校内上课，仅晚上18:00-21:00开放预约 ")):(i(),v("span",Ct," 周末：全天开放预约，时间为8:00-21:00 "))])]),e("div",Vt,[(i(),v(J,null,X(m,(w,L)=>e("div",{class:"legend-item",key:L},[e("div",{class:"legend-color",style:ge({backgroundColor:w})},null,4),e("span",Et,g(b[L]),1)])),64))]),ye((i(),v("div",Ht,[e("table",Mt,[e("thead",null,[e("tr",null,[l[2]||(l[2]=e("th",{class:"venue-header"},"场地/时间",-1)),(i(!0),v(J,null,X(O.value,w=>(i(),v("th",{key:w,class:"time-header"},g(w),1))),128))])]),e("tbody",null,[(i(!0),v(J,null,X(D.value,w=>(i(),v("tr",{key:w.id},[e("td",Nt,g(w.name),1),(i(!0),v(J,null,X(O.value,L=>(i(),v("td",{key:L,class:"status-cell",style:ge(c(w.id,L)),onClick:ie=>u(w,L),title:`${w.name} ${L} - ${b[U(w.id,L)]}`},g(b[U(w.id,L)]),13,Ot))),128))]))),128))])])])),[[q,S.value]]),l[3]||(l[3]=e("div",{class:"matrix-info"},[e("p",null,[e("strong",null,"使用说明：")]),e("ul",null,[e("li",null,"点击单元格可查看详细信息"),e("li",null,"绿色表示可预约，红色表示已预约，橙色表示维护中，灰色表示不开放"),e("li",null,"工作日白天时间段场地用于校内上课，不对外开放"),e("li",null,"周末全天开放预约")])],-1))])]),_:1},8,["modelValue"])}}},Rt=ue(Pt,[["__scopeId","data-v-64f68edf"]]),Yt={class:"create-order-form"},Bt={class:"form-header"},It={class:"form-title"},Ft={class:"form-section venue-section"},Ut={class:"section-header"},Lt={key:0,class:"venue-card"},At={class:"venue-info"},qt={class:"venue-name"},jt={class:"venue-description"},Wt={class:"venue-price"},Zt={class:"price-value"},Kt={class:"form-section time-section"},Qt={class:"section-header"},Gt={class:"time-display-grid"},Jt={class:"time-display-item"},Xt={class:"time-value"},ea={class:"time-display-item"},ta={class:"time-value"},aa={class:"time-display-item"},sa={class:"time-value"},oa={key:0,class:"booking-summary"},la={class:"summary-item"},na={class:"summary-value"},ia={class:"summary-item total-price"},ra={class:"summary-value price"},da={class:"price-note"},ca={class:"form-section contact-section"},ua={class:"section-header"},ma={class:"contact-form-grid"},pa={class:"form-section notice-section"},va={class:"section-header"},_a={class:"notice-content"},ga={class:"form-actions"},fa={__name:"CreateOrderForm",props:{selectedVenue:{type:Object,default:()=>({})},reservationDate:{type:String,default:""},startTime:{type:String,default:""},endTime:{type:String,default:""}},emits:["cancel"],setup(oe,{emit:Z}){const N=ze(),d=oe,j=Z,F=k(null),S=k(!1),y=k({venueId:"",contactName:"",contactPhone:"",remark:""}),E={venueId:[{required:!0,message:"请选择场地",trigger:"change"}],contactName:[{required:!0,message:"请输入联系人姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2-20个字符",trigger:"blur"},{pattern:/^[\u4e00-\u9fa5a-zA-Z\s]+$/,message:"姓名只能包含中文、英文和空格",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],remark:[{max:200,message:"备注不能超过200个字符",trigger:"blur"}]},O=ne(()=>{if(!d.startTime||!d.endTime)return 0;const[f]=d.startTime.split(":").map(Number),[s]=d.endTime.split(":").map(Number);return s-f}),D=ne(()=>{var s;const f=((s=d.selectedVenue)==null?void 0:s.price)||30;return Math.ceil(O.value)*f});$e(()=>d.selectedVenue,f=>{f!=null&&f.id&&(console.log(f),y.value.venueId=f.id)},{immediate:!0});const m=async()=>{if(!F.value)return!1;try{await F.value.validate();const f={venueId:d.selectedVenue.id,reservationDate:d.reservationDate,startTime:d.startTime,endTime:d.endTime,remark:y.value.contactName+" "+y.value.contactPhone+" "+y.value.remark};S.value=!0;try{I.info("正在创建订单...");const s=await et(f);if(s.data.code===0)N.push({path:"/payment",query:{orderNo:s.data.data.orderNo},state:{orderDetail:{id:s.data.data.id,venueName:d.selectedVenue.name,venueId:d.selectedVenue.id,reservationDate:f.reservationDate,startTime:f.startTime,endTime:f.endTime,duration:O.value,contactName:y.value.contactName,contactPhone:y.value.contactPhone,remark:s.data.data.remark,payTypeDesc:s.data.data.payTypeDesc,pricePerHour:s.data.data.pricePerHour||30,totalAmount:s.data.data.totalAmount}}});else return I.error(s.data.message||"创建订单失败"),!1}catch(s){return console.error("创建订单失败:",s),I.error("创建订单失败，请重试"),!1}finally{S.value=!1}}catch(f){return console.error("表单验证失败:",f),!1}},b=()=>{j("cancel")};return(f,s)=>{const T=Pe,A=Ie,U=Be,c=Fe,u=ce,B=Ue;return i(),v("div",Yt,[e("div",Bt,[e("h3",It,[o(T,null,{default:n(()=>[o(K(se))]),_:1}),s[3]||(s[3]=G(" 创建预约订单 "))]),s[4]||(s[4]=e("p",{class:"form-subtitle"},"请填写完整的预约信息，确保信息准确无误",-1))]),o(B,{ref_key:"formRef",ref:F,model:y.value,rules:E,"label-width":"100px",class:"order-form",size:"large"},{default:n(()=>{var p,l;return[e("div",Ft,[e("div",Ut,[o(T,{class:"section-icon"},{default:n(()=>[o(K(Re))]),_:1}),s[5]||(s[5]=e("h4",{class:"section-title"},"场地信息",-1))]),(p=d.selectedVenue)!=null&&p.id?(i(),v("div",Lt,[e("div",At,[e("h5",qt,g(d.selectedVenue.name),1),e("p",jt,g(d.selectedVenue.description||"标准羽毛球场地，配备专业羽毛球网和照明设备"),1),e("div",Wt,[s[6]||(s[6]=e("span",{class:"price-label"},"价格：",-1)),e("span",Zt,g(d.selectedVenue.price||30)+"元/小时",1)])])])):Q("",!0)]),e("div",Kt,[e("div",Qt,[o(T,{class:"section-icon"},{default:n(()=>[o(K(Te))]),_:1}),s[7]||(s[7]=e("h4",{class:"section-title"},"预约时间",-1))]),e("div",Gt,[e("div",Jt,[s[8]||(s[8]=e("span",{class:"time-label"},"预约日期",-1)),e("div",Xt,g(d.reservationDate||"未选择"),1)]),e("div",ea,[s[9]||(s[9]=e("span",{class:"time-label"},"开始时间",-1)),e("div",ta,g(d.startTime||"未选择"),1)]),e("div",aa,[s[10]||(s[10]=e("span",{class:"time-label"},"结束时间",-1)),e("div",sa,g(d.endTime||"未选择"),1)])]),O.value>0?(i(),v("div",oa,[e("div",la,[o(T,null,{default:n(()=>[o(K(Ye))]),_:1}),s[11]||(s[11]=e("span",{class:"summary-label"},"预约时长：",-1)),e("span",na,g(O.value)+"小时",1)]),e("div",ia,[o(T,null,{default:n(()=>[o(K(se))]),_:1}),s[12]||(s[12]=e("span",{class:"summary-label"},"预计费用：",-1)),e("span",ra,"¥"+g(D.value),1)]),e("div",da," （按"+g(((l=d.selectedVenue)==null?void 0:l.price)||30)+"元/小时计算，不足1小时按1小时计费） ",1)])):Q("",!0)]),e("div",ca,[e("div",ua,[o(T,{class:"section-icon"},{default:n(()=>[o(K(se))]),_:1}),s[13]||(s[13]=e("h4",{class:"section-title"},"联系人信息",-1))]),e("div",ma,[o(U,{label:"联系人姓名",prop:"contactName"},{default:n(()=>[o(A,{modelValue:y.value.contactName,"onUpdate:modelValue":s[0]||(s[0]=_=>y.value.contactName=_),placeholder:"请输入联系人姓名",disabled:S.value,clearable:"",size:"large"},{prefix:n(()=>[o(T,null,{default:n(()=>[o(K(se))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),o(U,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[o(A,{modelValue:y.value.contactPhone,"onUpdate:modelValue":s[1]||(s[1]=_=>y.value.contactPhone=_),placeholder:"请输入手机号码",disabled:S.value,clearable:"",size:"large",maxlength:"11"},{prefix:n(()=>[o(T,null,{default:n(()=>[o(K(se))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),o(U,{label:"备注信息",prop:"remark"},{default:n(()=>[o(A,{modelValue:y.value.remark,"onUpdate:modelValue":s[2]||(s[2]=_=>y.value.remark=_),type:"textarea",placeholder:"请输入备注信息（选填）",disabled:S.value,rows:3,maxlength:"200","show-word-limit":"",resize:"none"},null,8,["modelValue","disabled"])]),_:1})]),e("div",pa,[e("div",va,[o(T,{class:"section-icon"},{default:n(()=>[o(K(se))]),_:1}),s[14]||(s[14]=e("h4",{class:"section-title"},"预约须知",-1))]),e("div",_a,[o(c,{title:"重要提醒",type:"warning",closable:!1,"show-icon":""},{default:n(()=>s[15]||(s[15]=[e("ul",{class:"notice-list"},[e("li",null,"请确保预约信息准确无误，提交后不可修改"),e("li",null,"如需取消预约，请至少提前半小时联系管理员"),e("li",null,"请爱护场地设施，如有损坏需要赔偿"),e("li",null,"场地内禁止吸烟，请保持环境整洁")],-1)])),_:1})])]),e("div",ga,[o(u,{size:"large",disabled:S.value,onClick:b},{default:n(()=>s[16]||(s[16]=[G(" 取消 ")])),_:1},8,["disabled"]),o(u,{type:"primary",size:"large",loading:S.value,onClick:m},{default:n(()=>[G(g(S.value?"创建中...":"确认预约"),1)]),_:1},8,["loading"])])]}),_:1},8,["model"])])}}},ya=ue(fa,[["__scopeId","data-v-3d5b6ff2"]]),ba={class:"booking-container"},ha={class:"booking-tools"},ka={class:"date-time-selector"},$a={class:"selector-group"},Da={class:"matrix-button-container"},Ta={class:"date-status"},xa={class:"status-text"},Sa={key:0,class:"selector-group time-selector"},wa={class:"time-picker-container"},Ca={class:"time-picker"},Va={class:"time-picker"},Ea={class:"courts-container"},Ha={key:0,class:"loading-container"},Ma={class:"court-info"},Na={class:"court-name"},Oa={class:"court-status"},za={key:0,class:"court-price"},Pa={class:"court-actions"},Ra={key:2,class:"empty-state"},Ya={__name:"BookingView",setup(oe){const Z=a=>{const t=a.getFullYear(),x=String(a.getMonth()+1).padStart(2,"0"),h=String(a.getDate()).padStart(2,"0");return`${t}-${x}-${h}`},N=a=>{const t=a.getDay();return t>=1&&t<=5},d=a=>{const t=a.getDay();return t===0||t===6},j=(a,t)=>{const x=new Date,h=new Date;h.setHours(0,0,0,0);const C=new Date(h);C.setDate(C.getDate()+1);const M=new Date(a);if(M.setHours(0,0,0,0),M.getTime()===h.getTime()){const[R,W]=t.split(":").map(Number),V=new Date;return V.setHours(R,W,0,0),x<V}return M.getTime()===C.getTime()?x.getHours()>=18:!1},F=a=>{const t=new Date,x=new Date;x.setHours(0,0,0,0);const h=new Date(x);h.setDate(h.getDate()+1);const C=new Date(a);return C.setHours(0,0,0,0),C.getTime()===h.getTime()&&t.getHours()<18?"不在可预约时间（明天场地需今天18:00后预约）":null},S=a=>N(a)?["18:00-21:00"]:d(a)?["8:00-21:00"]:[],y=a=>{const t=S(a);if(t.length===0)return{startOptions:[],endOptions:[]};const x=[],h=[],C=t[0],[M,R]=C.split("-"),[W,V]=M.split(":").map(Number),[H,Y]=R.split(":").map(Number);let r=W,ee=V,ae=H-1,me=Y;for(me<ee&&(ae-=1,me+=60);r<ae||r===ae&&ee<=me;){const de=`${r.toString().padStart(2,"0")}:${ee.toString().padStart(2,"0")}`;j(a,de)&&x.push(de),r+=1}let re=W+1,_e=V;for(;re<H||re===H&&_e<=Y;){const de=`${re.toString().padStart(2,"0")}:${_e.toString().padStart(2,"0")}`;h.push(de),re+=1}const Se=[...new Set(x)].sort(),we=[...new Set(h)].sort();return{startOptions:Se,endOptions:we}},E=ne(()=>y(D.value).startOptions||[]),O=ne(()=>{const a=y(D.value);if(!m.value||a.endOptions.length===0)return a.endOptions||[];const[t,x]=m.value.split(":").map(Number),C=`${(t+3).toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;return a.endOptions.filter(M=>M<=C&&M>E.value[0])}),D=k(new Date),m=k("18:00"),b=k("19:00");N(D.value)?(m.value="18:00",b.value="21:00"):(m.value="8:00",b.value="21:00");const f=async a=>{const t=y(a);t.startOptions.length>0?(m.value=t.startOptions[0],b.value=t.endOptions[0]):(m.value="",b.value=""),m.value&&b.value&&m.value<b.value&&await c(a,m.value,b.value)},s=a=>{let t="";N(a)?t="工作日（仅晚上18:00-21:00开放）":d(a)&&(t="周末（全天开放8:00-21:00）");const x=F(a);return x&&(t+=` - ${x}`),t},T=k([]),A=k(!1),U=async()=>{A.value=!0;try{const a=await Je();a.data.code===0?T.value=a.data.data.map(t=>({id:t.id,name:t.name,description:t.description,price:t.pricePerHour||20,status:t.status,bookable:!1,availabilityReason:"请选择时间段",location:t.location})):I.error(a.message||"获取场地列表失败")}catch(a){console.error("获取场地列表失败:",a),I.error("获取场地列表失败，请稍后重试")}finally{A.value=!1}},c=async(a,t,x)=>{try{const h=F(a);if(h||!j(a,t)){T.value.forEach(R=>{R.bookable=!1,R.availabilityReason=h||"不在可预约时间"});return}const C=Z(a),M=await Xe({date:C,startTime:t,endTime:x});if(M.data.code===0){const{availableVenues:R,unavailableVenues:W}=M.data.data;T.value.forEach(V=>{V.bookable=!1,V.availabilityReason="未知状态"}),R&&R.length>0&&R.forEach(V=>{const H=T.value.find(Y=>Y.id===V.id);H&&(H.bookable=!0,H.availabilityReason="可预约",V.pricePerHour!==void 0&&(H.price=V.pricePerHour))}),W&&W.length>0&&W.forEach(V=>{const H=T.value.find(Y=>Y.id===V.id);H&&(H.bookable=!1,H.availabilityReason=V.reason||"不可预约")})}}catch(h){console.error("检查场地可用性失败:",h),T.value.forEach(C=>{C.bookable=!1,C.availabilityReason="检查失败"})}};fe(async()=>{await U(),await f(D.value),await le(m.value)});const u=k(!1),B=k(null),p=k(null),l=a=>{B.value=a,u.value=!0},_=()=>{u.value=!1,B.value=null},z=()=>{_()},P=k(!1),q=()=>{P.value=!1},w=()=>{P.value=!0},L=a=>!a.bookable||!m.value||!b.value?!1:j(D.value,m.value),ie=a=>{if(a.bookable===!0)return"status-available";{const t=a.availabilityReason||"";return t.includes("使用中")||a.status===2?"status-occupied":t.includes("维护")||a.status===4?"status-closed":"status-booked"}},$=a=>a.bookable===!0?"可预约":a.availabilityReason||"不可预约",le=async a=>{const t=y(D.value);if(t.startOptions.length!==0){if(a>=b.value){const[x,h]=a.split(":").map(Number);let C=x+1,M=h;const R=`${C.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`,V=`${(x+3).toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`,H=t.endOptions.filter(Y=>Y>=R&&Y<=V);if(H.length>0)b.value=H[0];else if(t.endOptions.length>0){const Y=t.endOptions.filter(r=>r<=V);Y.length>0&&(b.value=Y[Y.length-1])}}b.value&&await c(D.value,a,b.value)}},xe=async a=>{if(a<=m.value)if(N(D.value)){const t=O.value.indexOf(a);m.value=E.value[t]}else m.value="18:00";m.value&&await c(D.value,m.value,a)};return(a,t)=>{const x=De,h=ce,C=be,M=he,R=Ae,W=We,V=je,H=qe,Y=ve;return i(),v("div",ba,[t[13]||(t[13]=e("div",{class:"page-header"},[e("h2",null,"场地预约")],-1)),o(Dt),e("div",ha,[e("div",ka,[e("div",$a,[t[4]||(t[4]=e("p",null,"选择日期：",-1)),o(x,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=r=>D.value=r),type:"date",placeholder:"选择预约日期","disabled-date":r=>{const ee=new Date;ee.setHours(0,0,0,0);const ae=new Date(ee);return ae.setDate(ae.getDate()+1),!(r.toDateString()===ee.toDateString()||r.toDateString()===ae.toDateString())},format:"YYYY年MM月DD日",onChange:f},null,8,["modelValue","disabled-date"])]),e("div",Da,[o(h,{type:"primary",icon:K(Te),onClick:w,class:"matrix-button-enhanced",size:"large"},{default:n(()=>t[5]||(t[5]=[e("span",{class:"button-text"},"查看场地使用情况表",-1),e("span",{class:"button-subtitle"},"实时查看所有场地状态",-1)])),_:1},8,["icon"])]),e("div",Ta,[e("span",xa,g(s(D.value)),1)]),E.value.length>0?(i(),v("div",Sa,[t[7]||(t[7]=e("p",null,"时间段：",-1)),e("div",wa,[e("div",Ca,[o(M,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=r=>m.value=r),placeholder:"开始时间",onChange:le,class:"time-select"},{default:n(()=>[(i(!0),v(J,null,X(E.value,r=>(i(),te(C,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t[6]||(t[6]=e("span",{class:"time-separator"},"至",-1)),e("div",Va,[o(M,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=r=>b.value=r),placeholder:"结束时间",onChange:xe,class:"time-select"},{default:n(()=>[(i(!0),v(J,null,X(O.value,r=>(i(),te(C,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])])):Q("",!0)]),t[8]||(t[8]=e("div",{class:"booking-rules"},[e("p",null,[e("strong",null,"预约规则：")]),e("ul",null,[e("li",null,"工作日（周一至周五）：白天场地用于校内上课，仅晚上18:00-21:00开放预约"),e("li",null,"周末（周六、周日）：全天开放预约，时间为8:00-21:00"),e("li",null,"预约时长为1-3小时，每小时20元，时间选择步长为1小时"),e("li",null,"一人一天只能预约一次，如果当天已预约则无法再次预约"),e("li",null,"只能预约今天和明天的场地"),e("li",null,"今天场地：只要在开始时间之前都可以预约（如果有剩余）"),e("li",null,"明天场地：今天18:00之后才能开始预约")])],-1))]),e("div",Ea,[t[12]||(t[12]=e("h3",null,"场地状态",-1)),A.value?(i(),v("div",Ha,[o(R,{rows:3,animated:""}),t[9]||(t[9]=e("p",{class:"loading-text"},"正在加载场地信息...",-1))])):(i(),te(H,{key:1,gutter:20},{default:n(()=>[(i(!0),v(J,null,X(T.value,r=>(i(),te(V,{xs:24,sm:12,md:8,key:r.id},{default:n(()=>[o(W,{class:pe(["court-card",ie(r)])},{default:n(()=>[e("div",Ma,[e("div",Na,g(r.name),1),e("div",Oa,g($(r)),1),r.price?(i(),v("div",za,g(r.price)+"元/小时 ",1)):Q("",!0)]),e("div",Pa,[o(h,{type:"primary",disabled:!L(r),onClick:ee=>l(r)},{default:n(()=>t[10]||(t[10]=[G(" 预约 ")])),_:2},1032,["disabled","onClick"])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),!A.value&&T.value.length===0?(i(),v("div",Ra,t[11]||(t[11]=[e("p",null,"暂无可用场地",-1)]))):Q("",!0)]),t[14]||(t[14]=Le('<div class="booking-legend" data-v-e280bf96><div class="legend-item" data-v-e280bf96><div class="legend-color available" data-v-e280bf96></div><div class="legend-text" data-v-e280bf96>空闲中</div></div><div class="legend-item" data-v-e280bf96><div class="legend-color booked" data-v-e280bf96></div><div class="legend-text" data-v-e280bf96>已预约</div></div><div class="legend-item" data-v-e280bf96><div class="legend-color occupied" data-v-e280bf96></div><div class="legend-text" data-v-e280bf96>使用中</div></div><div class="legend-item" data-v-e280bf96><div class="legend-color closed" data-v-e280bf96></div><div class="legend-text" data-v-e280bf96>不开放</div></div></div>',1)),o(Y,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=r=>u.value=r),title:"创建预约订单",width:"700px","close-on-click-modal":!1,"before-close":_},{default:n(()=>[B.value?(i(),te(ya,{key:0,ref_key:"createOrderFormRef",ref:p,"selected-venue":B.value,"reservation-date":Z(D.value),"start-time":m.value,"end-time":b.value,onCancel:z},null,8,["selected-venue","reservation-date","start-time","end-time"])):Q("",!0)]),_:1},8,["modelValue"]),o(Rt,{visible:P.value,onClose:q},null,8,["visible"])])}}},rs=ue(Ya,[["__scopeId","data-v-e280bf96"]]);export{rs as default};
