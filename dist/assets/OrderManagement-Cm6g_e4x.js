import{ax as Q,d as it,f,w as a,q as S,p as _,j as s,ah as J,ai as W,l as t,B as r,a1 as X,F as g,U as Y,b9 as dt,ba as ct,ar as Z,as as tt,bb as ut,n as M,bc as mt,v as pt,s as et,a2 as _t,i as d,r as z,K as R,o as ft,E as p,ae as vt,ab as gt,ac as wt,b2 as yt,b4 as bt,M as ht,P as kt,Q as Dt,aU as Ct,_ as Tt,a0 as xt,c as P}from"./index-CZU4bJ5v.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  *//* empty css               *//* empty css                *//* empty css                  *//* empty css                   */import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                       */function Nt(l){return Q.get("/api/mall/orders/admin",{params:l})}function G(l){return Q.post(`/api/mall/orders/admin/${l}/close`)}function H(l,D){return Q.post(`/api/mall/orders/admin/${l}/complete`,null,{params:{pickupCode:D}})}const Et={key:0,class:"order-detail"},$t={class:"card-header"},Vt={class:"info-item"},Bt={class:"value"},Ot={class:"info-item"},zt={class:"value"},St={class:"info-item"},At={class:"value amount"},Ft={class:"info-item"},Pt={class:"value"},Mt={class:"timeline-content"},Ut={class:"timeline-time"},It={class:"timeline-content"},Lt={class:"timeline-time"},jt={class:"timeline-content"},qt={class:"timeline-time"},Kt={class:"timeline-content"},Qt={class:"timeline-time"},Rt={class:"timeline-content"},Gt={class:"timeline-time"},Ht={class:"product-info"},Jt={class:"product-name"},Wt={key:0,class:"product-desc"},Xt={class:"price"},Yt={class:"subtotal"},Zt={class:"total-section"},te={class:"total-row"},ee={class:"total-amount"},ae={class:"pickup-code"},se={class:"pickup-info"},oe={class:"pickup-value"},le={class:"dialog-footer"},ne={__name:"OrderDetailDialog",props:{modelValue:{type:Boolean,default:!1},orderData:{type:Object,default:()=>({})},showActions:{type:Boolean,default:!1}},emits:["update:modelValue","complete","close-order"],setup(l,{emit:D}){const C=l,b=D,N=it({get:()=>C.modelValue,set:k=>b("update:modelValue",k)}),v={10:"warning",20:"success",30:"info",40:"primary",50:"danger"},u={10:"待支付",20:"已支付",30:"已取消",40:"已完成",50:"已关闭"},h=k=>v[k]||"info",U=k=>u[k]||"未知状态",A=()=>{N.value=!1},w=()=>{b("complete",C.orderData)},I=()=>{b("close-order",C.orderData)};return(k,o)=>{const F=X,E=W,L=J,$=Y,T=ct,j=dt,V=tt,n=Z,e=ut,c=pt,y=et,q=_t;return d(),f(q,{modelValue:N.value,"onUpdate:modelValue":o[0]||(o[0]=m=>N.value=m),title:"订单详情",width:"800px","before-close":A,class:"order-detail-dialog"},{footer:a(()=>[t("div",le,[s(y,{onClick:A},{default:a(()=>o[16]||(o[16]=[g("关闭")])),_:1}),l.showActions&&l.orderData.status===20?(d(),f(y,{key:0,type:"success",onClick:w},{default:a(()=>o[17]||(o[17]=[g(" 完成提货 ")])),_:1})):_("",!0),l.showActions&&l.orderData.status!==50&&l.orderData.status!==40?(d(),f(y,{key:1,type:"danger",onClick:I},{default:a(()=>o[18]||(o[18]=[g(" 关闭订单 ")])),_:1})):_("",!0)])]),default:a(()=>[l.orderData?(d(),S("div",Et,[s($,{class:"info-card",shadow:"never"},{header:a(()=>[t("div",$t,[o[1]||(o[1]=t("span",{class:"title"},"订单信息",-1)),s(F,{type:h(l.orderData.status),size:"large"},{default:a(()=>[g(r(U(l.orderData.status)),1)]),_:1},8,["type"])])]),default:a(()=>[s(L,{gutter:20},{default:a(()=>[s(E,{span:12},{default:a(()=>[t("div",Vt,[o[2]||(o[2]=t("span",{class:"label"},"订单号：",-1)),t("span",Bt,r(l.orderData.orderNo),1)])]),_:1}),s(E,{span:12},{default:a(()=>[t("div",Ot,[o[3]||(o[3]=t("span",{class:"label"},"用户名：",-1)),t("span",zt,r(l.orderData.username||l.orderData.userName||"-"),1)])]),_:1}),s(E,{span:12},{default:a(()=>[t("div",St,[o[4]||(o[4]=t("span",{class:"label"},"订单金额：",-1)),t("span",At,"¥"+r((l.orderData.totalPrice||l.orderData.totalAmount||0).toFixed(2)),1)])]),_:1}),s(E,{span:12},{default:a(()=>[t("div",Ft,[o[5]||(o[5]=t("span",{class:"label"},"创建时间：",-1)),t("span",Pt,r(l.orderData.createTime||"-"),1)])]),_:1})]),_:1})]),_:1}),s($,{class:"timeline-card",shadow:"never"},{header:a(()=>o[6]||(o[6]=[t("span",{class:"title"},"订单状态",-1)])),default:a(()=>[s(j,null,{default:a(()=>[l.orderData.createTime?(d(),f(T,{key:0,timestamp:"订单创建",placement:"top",type:"primary"},{default:a(()=>[t("div",Mt,[o[7]||(o[7]=t("p",{class:"timeline-title"},"订单已创建",-1)),t("p",Ut,r(l.orderData.createTime),1)])]),_:1})):_("",!0),l.orderData.payTime?(d(),f(T,{key:1,timestamp:"订单支付",placement:"top",type:"success"},{default:a(()=>[t("div",It,[o[8]||(o[8]=t("p",{class:"timeline-title"},"订单已支付",-1)),t("p",Lt,r(l.orderData.payTime),1)])]),_:1})):_("",!0),l.orderData.shipTime?(d(),f(T,{key:2,timestamp:"订单发货",placement:"top",type:"warning"},{default:a(()=>[t("div",jt,[o[9]||(o[9]=t("p",{class:"timeline-title"},"订单已发货",-1)),t("p",qt,r(l.orderData.shipTime),1)])]),_:1})):_("",!0),l.orderData.completeTime?(d(),f(T,{key:3,timestamp:"订单完成",placement:"top",type:"success"},{default:a(()=>[t("div",Kt,[o[10]||(o[10]=t("p",{class:"timeline-title"},"订单已完成",-1)),t("p",Qt,r(l.orderData.completeTime),1)])]),_:1})):_("",!0),l.orderData.closeTime?(d(),f(T,{key:4,timestamp:"订单关闭",placement:"top",type:"danger"},{default:a(()=>[t("div",Rt,[o[11]||(o[11]=t("p",{class:"timeline-title"},"订单已关闭",-1)),t("p",Gt,r(l.orderData.closeTime),1)])]),_:1})):_("",!0)]),_:1})]),_:1}),s($,{class:"items-card",shadow:"never"},{header:a(()=>o[12]||(o[12]=[t("span",{class:"title"},"商品清单",-1)])),default:a(()=>[s(n,{data:l.orderData.orderItemList,style:{width:"100%"},"show-header":!0},{default:a(()=>[s(V,{prop:"productName",label:"商品名称","min-width":"200"},{default:a(m=>[t("div",Ht,[t("div",Jt,r(m.row.productName),1),m.row.productDesc?(d(),S("div",Wt,r(m.row.productDesc),1)):_("",!0)])]),_:1}),s(V,{prop:"price",label:"单价",width:"100",align:"right"},{default:a(m=>[t("span",Xt,"¥"+r(m.row.currentUnitPrice.toFixed(2)),1)]),_:1}),s(V,{prop:"quantity",label:"数量",width:"80",align:"center"},{default:a(m=>[s(F,{type:"info",size:"small"},{default:a(()=>[g(r(m.row.quantity),1)]),_:2},1024)]),_:1}),s(V,{label:"小计",width:"120",align:"right"},{default:a(m=>[t("span",Yt,"¥"+r(m.row.totalPrice.toFixed(2)),1)]),_:1})]),_:1},8,["data"]),t("div",Zt,[s(e),t("div",te,[o[13]||(o[13]=t("span",{class:"total-label"},"订单总额：",-1)),t("span",ee,"¥"+r((l.orderData.totalPrice||l.orderData.totalAmount||0).toFixed(2)),1)])])]),_:1}),l.orderData.status===40?(d(),f($,{key:0,class:"pickup-card",shadow:"never"},{header:a(()=>o[14]||(o[14]=[t("span",{class:"title"},"提货信息",-1)])),default:a(()=>[t("div",ae,[s(c,{class:"pickup-icon"},{default:a(()=>[s(M(mt))]),_:1}),t("div",se,[o[15]||(o[15]=t("div",{class:"pickup-label"},"提货码",-1)),t("div",oe,r(l.orderData.pickupCode),1)])])]),_:1})):_("",!0)])):_("",!0)]),_:1},8,["modelValue"])}}},re=at(ne,[["__scopeId","data-v-e693a940"]]),ie={class:"order-management"},de={class:"stat-content"},ce={class:"stat-number"},ue={class:"stat-content"},me={class:"stat-number"},pe={class:"stat-content"},_e={class:"stat-number"},fe={class:"stat-content"},ve={class:"stat-number"},ge={class:"stat-content"},we={class:"stat-number"},ye={class:"stat-content"},be={class:"stat-number"},he={class:"order-items"},ke={class:"amount"},De={class:"pagination-wrapper"},Ce={__name:"OrderManagement",setup(l){const D=z(!1),C=z([]),b=z(!1),N=z({}),v=R({username:"",orderNo:"",status:""}),u=R({pageNum:1,pageSize:10,total:0}),h=z({total:0,unpaid:0,paid:0,shipped:0,completed:0,cancelled:0,totalAmount:0}),U={10:"warning",20:"success",30:"info",40:"primary",50:"danger"},A={10:"待支付",20:"已支付",30:"已取消",40:"已完成",50:"已关闭"};ft(async()=>{await w()});const w=async()=>{D.value=!0;try{const n={pageNum:u.pageNum,pageSize:u.pageSize,username:v.username,orderNo:v.orderNo},e=await Nt(n);e.data.code===0?(C.value=e.data.data.list||[],u.total=e.data.data.total||0,I()):p.error(e.data.msg||"获取订单列表失败")}catch(n){console.error("获取订单列表出错",n),p.error("获取订单列表失败")}finally{D.value=!1}},I=()=>{const n={total:u.total,unpaid:0,paid:0,shipped:0,completed:0,cancelled:0,totalAmount:0};C.value.forEach(e=>{switch((e.status===20||e.status===40)&&(n.totalAmount+=e.totalPrice),e.status){case 10:n.unpaid++;break;case 20:n.paid++;break;case 30:n.cancelled++;break;case 40:n.completed++;break;case 50:n.closed++;break}}),h.value=n},k=()=>{u.pageNum=1,w()},o=()=>{Object.keys(v).forEach(n=>{v[n]=""}),k()},F=n=>{u.pageSize=n,w()},E=n=>{u.pageNum=n,w()},L=n=>{console.log(n),N.value=n,b.value=!0},$=async n=>{try{await P.confirm("确认关闭该订单吗？关闭后订单状态将变为已关闭","确认关闭订单",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const e=await G(n.orderNo);e.data.code===0?(p.success("订单关闭成功"),await w()):p.error(e.data.msg||"关闭订单失败")}catch(e){e!=="cancel"&&(console.error("关闭订单出错",e),p.error("关闭订单失败"))}},T=async n=>{try{const{value:e}=await P.prompt("请输入提货码以完成订单","验证提货码",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^.+$/,inputErrorMessage:"提货码不能为空"}),c=await H(n.orderNo,e);c.data.code===0?(p.success("订单完成成功"),await w()):p.error(c.data.msg||"完成订单失败")}catch(e){e!=="cancel"&&(console.error("完成订单出错",e),p.error("完成订单失败"))}},j=async n=>{try{const{value:e}=await P.prompt("请输入提货码以完成订单","验证提货码",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^.+$/,inputErrorMessage:"提货码不能为空"}),c=await H(n.orderNo,e);c.data.code===0?(p.success("订单完成成功"),b.value=!1,await w()):p.error(c.data.msg||"完成订单失败")}catch(e){e!=="cancel"&&(console.error("完成订单出错",e),p.error("完成订单失败"))}},V=async n=>{try{await P.confirm("确认关闭该订单吗？关闭后订单状态将变为已关闭","确认关闭订单",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const e=await G(n.orderNo);e.data.code===0?(p.success("订单关闭成功"),b.value=!1,await w()):p.error(e.data.msg||"关闭订单失败")}catch(e){e!=="cancel"&&(console.error("关闭订单出错",e),p.error("关闭订单失败"))}};return(n,e)=>{const c=Y,y=W,q=J,m=wt,K=gt,O=et,st=vt,x=tt,ot=X,lt=Z,nt=xt,rt=Tt;return d(),S("div",ie,[e[16]||(e[16]=t("div",{class:"page-header"},[t("h2",null,"商品订单管理"),t("p",null,"管理所有商品订单，包括待支付和已支付订单")],-1)),s(q,{gutter:20,class:"stats-cards"},{default:a(()=>[s(y,{span:4},{default:a(()=>[s(c,{class:"stat-card"},{default:a(()=>[t("div",de,[t("div",ce,r(h.value.total),1),e[5]||(e[5]=t("div",{class:"stat-label"},"总订单数",-1))])]),_:1})]),_:1}),s(y,{span:4},{default:a(()=>[s(c,{class:"stat-card unpaid"},{default:a(()=>[t("div",ue,[t("div",me,r(h.value.unpaid),1),e[6]||(e[6]=t("div",{class:"stat-label"},"待支付",-1))])]),_:1})]),_:1}),s(y,{span:4},{default:a(()=>[s(c,{class:"stat-card paid"},{default:a(()=>[t("div",pe,[t("div",_e,r(h.value.paid),1),e[7]||(e[7]=t("div",{class:"stat-label"},"已支付",-1))])]),_:1})]),_:1}),s(y,{span:4},{default:a(()=>[s(c,{class:"stat-card shipped"},{default:a(()=>[t("div",fe,[t("div",ve,r(h.value.completed),1),e[8]||(e[8]=t("div",{class:"stat-label"},"已完成",-1))])]),_:1})]),_:1}),s(y,{span:4},{default:a(()=>[s(c,{class:"stat-card completed"},{default:a(()=>[t("div",ge,[t("div",we,r(h.value.cancelled),1),e[9]||(e[9]=t("div",{class:"stat-label"},"已取消",-1))])]),_:1})]),_:1}),s(y,{span:4},{default:a(()=>[s(c,{class:"stat-card total-amount"},{default:a(()=>[t("div",ye,[t("div",be,"¥"+r(h.value.totalAmount.toFixed(2)),1),e[10]||(e[10]=t("div",{class:"stat-label"},"总交易额",-1))])]),_:1})]),_:1})]),_:1}),s(c,{class:"search-card"},{default:a(()=>[s(st,{model:v,inline:""},{default:a(()=>[s(K,{label:"用户名"},{default:a(()=>[s(m,{modelValue:v.username,"onUpdate:modelValue":e[0]||(e[0]=i=>v.username=i),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),s(K,{label:"订单号"},{default:a(()=>[s(m,{modelValue:v.orderNo,"onUpdate:modelValue":e[1]||(e[1]=i=>v.orderNo=i),placeholder:"请输入订单号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),s(K,null,{default:a(()=>[s(O,{type:"primary",icon:M(yt),onClick:k},{default:a(()=>e[11]||(e[11]=[g(" 搜索 ")])),_:1},8,["icon"]),s(O,{icon:M(bt),onClick:o},{default:a(()=>e[12]||(e[12]=[g(" 重置 ")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),s(c,{class:"table-card"},{default:a(()=>[ht((d(),f(lt,{data:C.value,stripe:"",style:{width:"100%"}},{default:a(()=>[s(x,{prop:"orderNo",label:"订单号",width:"200"}),s(x,{prop:"username",label:"用户",width:"200"}),s(x,{label:"商品信息","min-width":"200"},{default:a(i=>[t("div",he,[(d(!0),S(kt,null,Dt(i.row.orderItemList,B=>(d(),S("div",{key:B.productName,class:"item"},r(B.productName)+" × "+r(B.quantity),1))),128))])]),_:1}),s(x,{prop:"totalAmount",label:"总金额",width:"100"},{default:a(i=>[t("span",ke,"¥"+r(i.row.totalPrice.toFixed(2)),1)]),_:1}),s(x,{prop:"status",label:"状态",width:"100"},{default:a(i=>[s(ot,{type:U[i.row.status]},{default:a(()=>[g(r(A[i.row.status]),1)]),_:2},1032,["type"])]),_:1}),s(x,{prop:"createTime",label:"创建时间",width:"160"}),s(x,{label:"操作",width:"300",fixed:"right"},{default:a(i=>[s(O,{type:"primary",size:"small",icon:M(Ct),onClick:B=>L(i.row)},{default:a(()=>e[13]||(e[13]=[g(" 查看 ")])),_:2},1032,["icon","onClick"]),i.row.status===20?(d(),f(O,{key:0,type:"success",size:"small",onClick:B=>T(i.row)},{default:a(()=>e[14]||(e[14]=[g(" 完成提货 ")])),_:2},1032,["onClick"])):_("",!0),i.row.status!==50?(d(),f(O,{key:1,type:"danger",size:"small",onClick:B=>$(i.row)},{default:a(()=>e[15]||(e[15]=[g(" 关闭订单 ")])),_:2},1032,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])),[[rt,D.value]]),t("div",De,[s(nt,{"current-page":u.pageNum,"onUpdate:currentPage":e[2]||(e[2]=i=>u.pageNum=i),"page-size":u.pageSize,"onUpdate:pageSize":e[3]||(e[3]=i=>u.pageSize=i),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),s(re,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=i=>b.value=i),"order-data":N.value,"show-actions":!0,onComplete:j,onCloseOrder:V},null,8,["modelValue","order-data"])])}}},qe=at(Ce,[["__scopeId","data-v-cfb6c914"]]);export{qe as default};
