import{r as f,L as K,o as Q,q as k,l as h,j as l,M as W,w as o,ae as ee,_ as te,f as v,p,a0 as ae,a2 as le,E as d,ar as oe,b as re,i as u,ab as se,Z as ne,Y as ue,$ as ie,as as de,a1 as ce,F as s,B as n,s as me,aN as ve,aO as pe,c as A}from"./index-CHTw6ThQ.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                 *//* empty css                     */import{g as _e,O as fe,a as ye,b as we,d as ge,e as be}from"./venueOrder-KBvfAOcC.js";/* empty css                       */import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"booking-history"},he={class:"container"},Ee={class:"filter-section"},Be={class:"table-container"},Ce={key:2,class:"pagination"},De={key:0,class:"booking-detail"},Ne={class:"dialog-footer"},xe={__name:"BookingHistory",setup(Se){const M=re(),m=f(!1),g=f({status:""});K(()=>g.value.status,t=>{T(t)});const N=f(1),H=f(10),x=f(0),b=f([]),w=f(!1),a=f(null),T=async t=>{try{m.value=!0;const e=await _e(t);e.data.code===0?(b.value=e.data.data.list||[],x.value=e.data.data.total):d.error(e.message||"获取订单列表失败")}catch(e){console.error("获取订单列表失败:",e),d.error("获取订单列表失败，请稍后重试")}finally{m.value=!1}},I=t=>{N.value=t},F=async t=>{try{m.value=!0;const e=await we(t.id);e.data.code===0?(a.value=e.data.data,a.value.contactName=e.data.data.remark.split(" ")[0],a.value.contactPhone=e.data.data.remark.split(" ")[1],w.value=!0):d.error(e.message||"获取订单详情失败")}catch(e){console.error("获取订单详情失败:",e),d.error("获取订单详情失败，请稍后重试")}finally{m.value=!1}},S=t=>{if(!t)return!0;const e=new Date;e.setHours(0,0,0,0);const i=new Date(t.date);return i.setHours(0,0,0,0),i<e},E=t=>t?t.status==="reserved"||t.status===1:!1,$=t=>t&&(t.status==="cancelled"||t.status===4)?"已取消":"取消预订",V=t=>ye[t]||t,R=t=>fe[t]||"",U=async t=>{const e=t.remark,[i,B,C]=e.split(" ");M.push({path:"/payment",query:{orderNo:t.orderNo},state:{booking:{id:t.id,venueName:t.venueName,venueId:t.venueId,reservationDate:t.reservationDate,startTime:t.startTime,endTime:t.endTime,duration:t.duration,contactName:i,contactPhone:B,remarkMessage:C,pricePerHour:t.pricePerHour,totalAmount:t.totalAmount,createTime:t.createTime}}})},O=async t=>{try{await A.confirm(`确定要取消 ${t.reservationDate} ${t.timeSlot} ${t.venueName} 的预订吗？取消后无法恢复。`,"取消预订",{confirmButtonText:"确定",cancelButtonText:"返回",type:"warning"}),m.value=!0;const e=await ge(t.id,{reason:"用户主动取消"});e.data.code===0?(d.success(e.data.data),await T()):d.error(e.message||"取消预订失败")}catch(e){e==="cancel"?d.info("已取消操作"):(console.error("取消预订失败:",e),d.error("取消预订失败，请稍后重试"))}finally{m.value=!1}},L=async()=>{a.value&&(await O(a.value),w.value=!1)},P=async t=>{try{await A.confirm("确定要申请退款吗？退款申请提交后需要管理员审核,并需要到线下退款。","申请退款",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=!0;const e=await be(t.id,{reason:"用户申请退款"});e.data.code===0?(d.success("退款申请已提交，等待管理员审核"),await T()):d.error(e.message||"申请退款失败")}catch(e){e==="cancel"?d.info("已取消操作"):(console.error("申请退款失败:",e),d.error("申请退款失败，请稍后重试"))}finally{m.value=!1}};return Q(()=>{T()}),(t,e)=>{const i=ue,B=ne,C=se,q=ee,j=ie,_=de,z=ce,y=me,X=oe,Y=ae,c=pe,Z=ve,G=le,J=te;return u(),k("div",ke,[h("div",he,[e[7]||(e[7]=h("h2",{class:"page-title"},"我的预订记录",-1)),h("div",Ee,[l(q,{inline:!0,model:g.value},{default:o(()=>[l(C,{label:"预订状态"},{default:o(()=>[l(B,{modelValue:g.value.status,"onUpdate:modelValue":e[0]||(e[0]=r=>g.value.status=r),placeholder:"预订状态",clearable:"",style:{width:"120px"}},{default:o(()=>[l(i,{label:"全部",value:""}),l(i,{label:"待支付",value:"1"}),l(i,{label:"已支付",value:"2"}),l(i,{label:"已完成",value:"3"}),l(i,{label:"已取消",value:"4"}),l(i,{label:"已退款",value:"5"}),l(i,{label:"退款中",value:"6"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),W((u(),k("div",Be,[b.value.length===0&&!m.value?(u(),v(j,{key:0,description:"暂无预订记录"})):(u(),v(X,{key:1,data:b.value,style:{width:"100%"},border:""},{default:o(()=>[l(_,{prop:"id",label:"预订号",width:"80"}),l(_,{prop:"venueName",label:"场地名称",width:"120"}),l(_,{prop:"reservationDate",label:"预订日期",width:"120"}),l(_,{prop:"timeSlot",label:"时间段",width:"120"}),l(_,{prop:"totalAmount",label:"金额(元)",width:"100"}),l(_,{prop:"status",label:"状态",width:"120"},{default:o(r=>[l(z,{type:R(r.row.status)},{default:o(()=>[s(n(V(r.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(_,{prop:"createTime",label:"预订时间",width:"160"}),l(_,{label:"操作",fixed:"right",width:"300"},{default:o(r=>[l(y,{type:"primary",size:"small",onClick:D=>F(r.row)},{default:o(()=>e[4]||(e[4]=[s(" 查看详情 ")])),_:2},1032,["onClick"]),r.row.status===1?(u(),v(y,{key:0,type:"success",size:"small",onClick:D=>U(r.row)},{default:o(()=>e[5]||(e[5]=[s(" 立即支付 ")])),_:2},1032,["onClick"])):p("",!0),r.row.status===1?(u(),v(y,{key:1,type:"danger",size:"small",onClick:D=>O(r.row),disabled:S(r.row)||!E(r.row)},{default:o(()=>[s(n($(r.row)),1)]),_:2},1032,["onClick","disabled"])):p("",!0),r.row.status===2?(u(),v(y,{key:2,type:"warning",size:"small",onClick:D=>P(r.row),disabled:r.row.status!==2},{default:o(()=>e[6]||(e[6]=[s(" 申请退款 ")])),_:2},1032,["onClick","disabled"])):p("",!0)]),_:1})]),_:1},8,["data"])),b.value.length>0?(u(),k("div",Ce,[l(Y,{background:"",layout:"prev, pager, next, total",total:x.value,"page-size":H.value,"current-page":N.value,onCurrentChange:I},null,8,["total","page-size","current-page"])])):p("",!0)])),[[J,m.value]])]),l(G,{title:"预订详情",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=r=>w.value=r),width:"500px",center:""},{footer:o(()=>[h("span",Ne,[l(y,{onClick:e[1]||(e[1]=r=>w.value=!1)},{default:o(()=>e[8]||(e[8]=[s("关闭")])),_:1}),a.value&&E(a.value)?(u(),v(y,{key:0,type:"danger",onClick:L,disabled:S(a.value)||!E(a.value)},{default:o(()=>[s(n($(a.value)),1)]),_:1},8,["disabled"])):p("",!0),a.value&&(a.value.status===1||a.value.status==="reserved")?(u(),v(y,{key:1,type:"warning",onClick:e[2]||(e[2]=r=>P(a.value))},{default:o(()=>e[9]||(e[9]=[s(" 申请退款 ")])),_:1})):p("",!0)])]),default:o(()=>[a.value?(u(),k("div",De,[l(Z,{column:1,border:!0},{default:o(()=>[l(c,{label:"预订编号"},{default:o(()=>[s(n(a.value.id),1)]),_:1}),a.value.orderNo?(u(),v(c,{key:0,label:"订单号"},{default:o(()=>[s(n(a.value.orderNo),1)]),_:1})):p("",!0),l(c,{label:"场地名称"},{default:o(()=>[s(n(a.value.courtName||a.value.venueName),1)]),_:1}),l(c,{label:"预订日期"},{default:o(()=>[s(n(a.value.date||a.value.reservationDate),1)]),_:1}),l(c,{label:"预订时段"},{default:o(()=>[s(n(a.value.timeSlot||`${a.value.startTime}-${a.value.endTime}`),1)]),_:1}),l(c,{label:"预订价格"},{default:o(()=>[s(n(a.value.price||a.value.totalAmount)+" 元",1)]),_:1}),l(c,{label:"预订状态"},{default:o(()=>[l(z,{type:R(a.value.status)},{default:o(()=>[s(n(V(a.value.status)),1)]),_:1},8,["type"])]),_:1}),l(c,{label:"预订人"},{default:o(()=>[s(n(a.value.contactName),1)]),_:1}),l(c,{label:"联系电话"},{default:o(()=>[s(n(a.value.contactPhone),1)]),_:1}),l(c,{label:"预订时间"},{default:o(()=>[s(n(a.value.createTime||a.value.createdAt),1)]),_:1}),a.value.remark||a.value.note?(u(),v(c,{key:1,label:"备注"},{default:o(()=>[s(n(a.value.remark.split(" ")[2]),1)]),_:1})):p("",!0)]),_:1})])):p("",!0)]),_:1},8,["modelValue"])])}}},Je=Te(xe,[["__scopeId","data-v-edab4659"]]);export{Je as default};
