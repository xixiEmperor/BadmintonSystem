import{u as M,r as u,o as $,L as C,q as k,l,j as s,w as n,s as j,ac as H,an as K,n as E,ar as Q,a0 as A,b as G,i as v,F as g,P as J,Q as O,f as S,aq as W,as as X,p as Y,v as Z,aH as ee,B as c,E as te}from"./index-CZU4bJ5v.js";/* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                    *//* empty css                  */import{g as oe}from"./forum-Dsj9shzh.js";import{u as ae}from"./forum-6XYpnF_V.js";import{f as z}from"./format-BoKD-3ja.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"forum-container"},ne={class:"forum-actions"},re={class:"forum-content"},ie={class:"topics-container"},ue=["onClick"],pe={class:"topic-author"},ce={class:"topic-stats"},me={class:"topic-last-reply"},de={class:"pagination-container"},_e={__name:"ForumView",setup(ve){const f=G(),b=M(),T=ae(),D=u([{name:"all",label:"全部帖子"},{name:"team",label:"打球组队"},{name:"notice",label:"赛事讨论"},{name:"help",label:"求助问答"},{name:"exp",label:"经验交流"}]),m=u("all"),d=u("");let h=null;const i=u(1),w=u(5),y=u(0),p=async()=>{const o=await oe({page:i.value,pageSize:w.value,keyword:d.value,category:m.value});if(o.data.code===0){console.log(o);const t=o.data.data.list.map(a=>({...a,publishTime:z(a.publishTime),lastReply:z(a.lastReply)}));t.sort((a,r)=>a.isTop&&!r.isTop?-1:!a.isTop&&r.isTop?1:a.isTop&&r.isTop?new Date(r.topTime||r.publishTime)-new Date(a.topTime||a.publishTime):new Date(r.publishTime)-new Date(a.publishTime)),T.setPosts(t),y.value=o.data.data.total}};$(async()=>{await p()});const x=()=>{console.log("点击发布新帖按钮"),console.log("当前路由器实例:",f),console.log("UserStore状态:",{token:b.token,userinfo:b.userinfo});try{f.push("/publish-post"),console.log("路由跳转命令已执行")}catch(o){console.error("路由跳转失败:",o),te.error("页面跳转失败，请刷新页面后重试")}},F=o=>{const t=f.resolve(`/post/${o}`);window.open(t.href,"_blank")},V=()=>{h&&clearTimeout(h),h=setTimeout(()=>{i.value=1,p()},500)},P=o=>{i.value=o,p()},B=o=>{w.value=o,i.value=1,p()};C(m,()=>{i.value=1,p()}),C(d,()=>{V()});const R=({row:o})=>o.isTop?"top-row":"";return(o,t)=>{const a=j,r=H,U=W,L=K,N=Z,_=X,I=Q,q=A;return v(),k("div",se,[t[5]||(t[5]=l("h2",null,"羽你同行论坛",-1)),l("div",ne,[s(a,{type:"primary",onClick:x},{default:n(()=>t[3]||(t[3]=[g("发布新帖")])),_:1}),s(r,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),placeholder:"搜索论坛内容",class:"search-input"},{append:n(()=>[s(a,{onClick:V},{default:n(()=>t[4]||(t[4]=[g("搜索")])),_:1})]),_:1},8,["modelValue"])]),l("div",re,[s(L,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),class:"demo-tabs"},{default:n(()=>[(v(!0),k(J,null,O(D.value,e=>(v(),S(U,{key:e.name,label:e.label,name:e.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),l("div",ie,[s(I,{data:E(T).posts,style:{width:"100%"},"row-class-name":R},{default:n(()=>[s(_,{prop:"title",label:"主题","min-width":"300"},{default:n(e=>[l("div",{class:"topic-title",onClick:fe=>F(e.row.id)},[e.row.isTop?(v(),S(N,{key:0,class:"top-icon"},{default:n(()=>[s(E(ee))]),_:1})):Y("",!0),g(" "+c(e.row.title),1)],8,ue)]),_:1}),s(_,{prop:"author",label:"作者",width:"120"},{default:n(e=>[l("div",pe,c(e.row.author),1)]),_:1}),s(_,{prop:"replies",label:"回复/查看",width:"120"},{default:n(e=>[l("div",ce,[l("div",null,c(e.row.replyCount||0)+" 回复",1),l("div",null,c(e.row.views)+" 查看",1)])]),_:1}),s(_,{prop:"lastReply",label:"最后回复",width:"120"},{default:n(e=>[l("div",me,c(e.row.lastReply),1)]),_:1})]),_:1},8,["data"])]),l("div",de,[s(q,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),"page-size":w.value,total:y.value,"page-sizes":[5,8,10,15],layout:"total, sizes, prev, pager, next",onSizeChange:B,onCurrentChange:P},null,8,["modelValue","page-size","total"])])])])}}},Pe=le(_e,[["__scopeId","data-v-d7f425c5"]]);export{Pe as default};
