import{r as f,f as F,w as o,ah as S,b as q,i as U,j as e,ai as N,ae as R,ab as j,l as y,ac as M,n as g,bg as $,s as h,F as _,B as z,bf as V,b5 as D,E as u}from"./index-CZU4bJ5v.js";/* empty css               *//* empty css                     *//* empty css                *//* empty css                  *//* empty css                 */import{V as L,a as O,d as T}from"./VerificationCodeInput-BALEV3uv.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"verify-code-section"},H={name:"ForgetPasswordView"},J=Object.assign(H,{setup(K){const w=q(),l=f({email:"",verificationCode:"",newPassword:"",confirmPassword:""}),P={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"请输入6位验证码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{pattern:/^\S{6,15}$/,message:"请输入6-15位非空密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(r,a,c)=>{a!==l.value.newPassword?c(new Error("两次输入的密码不一致")):c()},trigger:"blur"}]},m=f(),p=f(!1),d=f(!1),n=f(0);let i=null;const C=async()=>{try{await m.value.validateField(["email"]),d.value=!0;const r=await O({email:l.value.email,type:"reset"});r.data.code===0?(u.success("验证码已发送至您的邮箱"),n.value=60,i=setInterval(()=>{n.value--,n.value<=0&&(clearInterval(i),i=null,d.value=!1)},1e3)):(u.error(r.data.msg||"发送验证码失败"),d.value=!1)}catch(r){console.error("发送验证码错误:",r),u.error("发送验证码失败，请检查邮箱格式"),d.value=!1}},x=async()=>{try{await m.value.validate(),p.value=!0;const r=await T({email:l.value.email,verificationCode:l.value.verificationCode,newPassword:l.value.newPassword});r.data.code===0?(u.success("密码重置成功"),w.push("/login")):u.error(r.data.msg||"密码重置失败")}catch(r){console.error("重置密码错误:",r),u.error("密码重置失败")}finally{p.value=!1}},E=()=>{i&&(clearInterval(i),i=null),w.push("/login")};return(r,a)=>{const c=N,s=j,v=M,b=h,k=D,I=R,B=S;return U(),F(B,{class:"login-page"},{default:o(()=>[e(c,{span:12,class:"bg"}),e(c,{span:6,offset:3,class:"form"},{default:o(()=>[e(I,{model:l.value,rules:P,ref_key:"form",ref:m,size:"large",autocomplete:"off"},{default:o(()=>[e(s,null,{default:o(()=>a[4]||(a[4]=[y("h1",null,"找回密码",-1)])),_:1}),e(s,{prop:"email"},{default:o(()=>[e(v,{modelValue:l.value.email,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.email=t),"prefix-icon":g($),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue","prefix-icon"])]),_:1}),e(s,{prop:"verificationCode"},{default:o(()=>[y("div",G,[e(L,{modelValue:l.value.verificationCode,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.verificationCode=t),length:6},null,8,["modelValue"]),e(b,{type:"primary",disabled:d.value||n.value>0,onClick:C,class:"verify-code-btn"},{default:o(()=>[_(z(n.value>0?`${n.value}秒后重新获取`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1}),e(s,{prop:"newPassword"},{default:o(()=>[e(v,{modelValue:l.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.newPassword=t),"prefix-icon":g(V),type:"password",placeholder:"请输入新密码"},null,8,["modelValue","prefix-icon"])]),_:1}),e(s,{prop:"confirmPassword"},{default:o(()=>[e(v,{modelValue:l.value.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=t=>l.value.confirmPassword=t),"prefix-icon":g(V),type:"password",placeholder:"请确认新密码"},null,8,["modelValue","prefix-icon"])]),_:1}),e(s,null,{default:o(()=>[e(b,{onClick:x,class:"button",type:"primary","auto-insert-space":"",loading:p.value},{default:o(()=>a[5]||(a[5]=[_(" 保存 ")])),_:1},8,["loading"])]),_:1}),e(s,{class:"flex"},{default:o(()=>[e(k,{type:"info",underline:!1,onClick:E},{default:o(()=>a[6]||(a[6]=[_(" ← 返回登录 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})}}}),oe=A(J,[["__scopeId","data-v-a4c8c7b3"]]);export{oe as default};
