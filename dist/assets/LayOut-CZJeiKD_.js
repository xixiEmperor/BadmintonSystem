import{u as R,r as b,o as N,a as Y,E as P,b as O,c as V,d as Z,e as ee,f as m,w as t,g as te,h as z,i,j as o,k as oe,l as n,m as ne,n as h,p as E,q as L,s as se,t as ae,v as le,x as re,y as D,z as ue,A as ie,B as ce,C as de,D as pe,F as u,G as _e,H as fe,I as me,J as ve}from"./index-CZU4bJ5v.js";/* empty css                *//* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  *//* empty css                         *//* empty css                        */import{n as ge}from"./router-Dzn69TfO.js";/* empty css                       *//* empty css                 *//* empty css                   */import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as he}from"./cart-CoxZf9o3.js";const ye="/assets/whlg_logo-eAl-Tk7z.png";function we(A={}){const{warningTime:d=30*60*1e3,checkInterval:I=5*60*1e3}=A,a=R(),p=O(),c=b(null),_=b(!1),s=()=>{if(!a.token)return;const l=a.getTokenRemainingTime();if(l<=0){r();return}l<=d&&!_.value&&(y(l),_.value=!0)},r=()=>{f(),a.logout(),P.warning("登录已过期，请重新登录");const l=p.currentRoute.value.fullPath;l!=="/login"&&p.push({path:"/login",query:{redirect:l}})},y=l=>{const M=Math.floor(l/6e4);V.confirm(`您的登录状态将在 ${M} 分钟后过期，是否需要延长登录时间？`,"登录即将过期",{confirmButtonText:"延长登录",cancelButtonText:"稍后处理",type:"warning"}).then(()=>{B()}).catch(()=>{P.info("请注意登录状态，避免操作中断")})},B=()=>{const l=p.currentRoute.value.fullPath;p.push({path:"/login",query:{redirect:l,refresh:"true"}})},w=()=>{c.value&&clearInterval(c.value),s(),c.value=setInterval(s,I)},f=()=>{c.value&&(clearInterval(c.value),c.value=null),_.value=!1};return N(()=>{a.token&&w()}),Y(()=>{f()}),{startTokenCheck:w,stopTokenCheck:f,checkTokenStatus:s}}const xe={class:"header__content"},Ce={class:"container"},Te={class:"header__logo"},Ee={class:"user-area"},be={key:4,class:"user-info"},Ie={class:"user-info-wrapper"},Be={class:"user-avatar"},Me=["src"],Le={key:1,src:"https://tse1-mm.cn.bing.net/th/id/OIP-C.gaAkkFf8LStn-oc4l8iM0wAAAA?w=160&h=180&c=7&r=0&o=5&dpr=1.5&pid=1.7",alt:"默认头像"},Ae={class:"username"},Se={class:"nav"},Ue={class:"container"},Pe={__name:"LayOut",setup(A){const d=R(),I=he(),a=O(),{startTokenCheck:p,stopTokenCheck:c}=we({warningTime:30*60*1e3,checkInterval:5*60*1e3}),_=Z(()=>I.totalCount),s=b(!1),r=b({});r.value=d.userinfo;const y=v=>{const{avatarUrl:e}=v.detail;r.value&&(r.value={...r.value,avatar:e})},B=()=>{if(d.token&&!d.isTokenExpired())try{s.value=!0,p()}catch(v){console.error("解析用户信息失败",v),s.value=!1}else s.value=!1,c()},w=()=>{a.push("/user-center")},f=()=>{a.push("/my-history-post")},l=()=>{ge("/login")},M=()=>{a.push("/cart")},S=()=>{a.push("/booking-history")},U=()=>{a.push("/orders")},q=()=>{V.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.logout(),s.value=!1,r.value={username:"",avatar:""},a.currentRoute.value.path==="/user-center"&&a.push("/")})};return N(()=>{B(),window.addEventListener("user-avatar-updated",y)}),ee(()=>{window.removeEventListener("user-avatar-updated",y)}),(v,e)=>{const F=ne,x=le,H=ae,g=se,k=pe,W=de,$=ie,C=z("router-link"),T=fe,j=_e,G=oe,J=z("router-view"),K=me,Q=ve,X=te;return i(),m(X,{class:"layout-container"},{default:t(()=>[o(G,{class:"header"},{default:t(()=>[n("div",xe,[n("div",Ce,[n("div",Te,[o(F,{src:h(ye),alt:"",fit:"contain",style:{width:"300px",height:"100px"}},null,8,["src"]),e[0]||(e[0]=n("p",{style:{"font-size":"22px"}},"南湖校区羽毛球场地预定",-1))]),n("div",Ee,[s.value?(i(),m(g,{key:0,type:"text",class:"cart-btn",onClick:M},{default:t(()=>[o(H,{value:_.value,hidden:_.value===0},{default:t(()=>[o(x,null,{default:t(()=>[o(h(re))]),_:1})]),_:1},8,["value","hidden"]),e[1]||(e[1]=n("span",null,"购物车",-1))]),_:1})):E("",!0),s.value?(i(),m(g,{key:1,type:"text",class:"booking-history-btn",onClick:U},{default:t(()=>[o(x,null,{default:t(()=>[o(h(D))]),_:1}),e[2]||(e[2]=n("span",null,"商品订单",-1))]),_:1})):E("",!0),s.value?(i(),m(g,{key:2,type:"text",class:"booking-history-btn",onClick:S},{default:t(()=>[o(x,null,{default:t(()=>[o(h(D))]),_:1}),e[3]||(e[3]=n("span",null,"场地预订",-1))]),_:1})):E("",!0),s.value?(i(),m(g,{key:3,type:"text",class:"user-center-btn",onClick:f},{default:t(()=>[o(x,null,{default:t(()=>[o(h(ue))]),_:1}),e[4]||(e[4]=n("span",null,"我的发帖",-1))]),_:1})):E("",!0),s.value?(i(),L("div",be,[o($,{trigger:"click"},{dropdown:t(()=>[o(W,null,{default:t(()=>[o(k,{onClick:w},{default:t(()=>e[5]||(e[5]=[u("个人中心")])),_:1}),o(k,{onClick:f},{default:t(()=>e[6]||(e[6]=[u("我的发帖")])),_:1}),o(k,{onClick:S},{default:t(()=>e[7]||(e[7]=[u("场地预订")])),_:1}),o(k,{onClick:U},{default:t(()=>e[8]||(e[8]=[u("商品订单")])),_:1}),o(k,{onClick:q},{default:t(()=>e[9]||(e[9]=[u("退出登录")])),_:1})]),_:1})]),default:t(()=>[n("div",Ie,[n("div",Be,[r.value.avatar?(i(),L("img",{key:0,src:r.value.avatar,alt:"头像"},null,8,Me)):(i(),L("img",Le))]),n("span",Ae,ce(r.value.username),1)])]),_:1})])):(i(),m(g,{key:5,type:"primary",size:"large",class:"login",onClick:l},{default:t(()=>e[10]||(e[10]=[u(" 登录 / 注册 ")])),_:1}))])]),n("div",Se,[n("div",Ue,[o(j,{"default-active":v.$route.path,class:"el-menu-demo",mode:"horizontal","background-color":"rgb(41, 108, 182)","text-color":"#fff","active-text-color":"#ffd04b"},{default:t(()=>[o(T,{index:"/home"},{default:t(()=>[o(C,{to:"/home"},{default:t(()=>e[11]||(e[11]=[u("首页")])),_:1})]),_:1}),o(T,{index:"/booking"},{default:t(()=>[o(C,{to:"/booking"},{default:t(()=>e[12]||(e[12]=[u("场地预定")])),_:1})]),_:1}),o(T,{index:"/shop"},{default:t(()=>[o(C,{to:"/shop"},{default:t(()=>e[13]||(e[13]=[u("羽体商城")])),_:1})]),_:1}),o(T,{index:"/forum"},{default:t(()=>[o(C,{to:"/forum"},{default:t(()=>e[14]||(e[14]=[u("羽你同行论坛")])),_:1})]),_:1})]),_:1},8,["default-active"])])])])]),_:1}),o(K,{class:"main-content"},{default:t(()=>[o(J)]),_:1}),o(Q,{class:"footer-container"},{default:t(()=>e[15]||(e[15]=[n("div",{class:"footer"},[n("div",{class:"container"},[n("p",null,"版权所有 © 2025 南湖校区羽毛球场预定系统"),n("p",null,"联系电话: 12345678901 | 地址: 南湖校区体育中心一楼")])],-1)])),_:1})]),_:1})}}},Ke=ke(Pe,[["__scopeId","data-v-0551887a"]]);export{Ke as default};
