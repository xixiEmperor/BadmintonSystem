import{ax as k,r as h,K as V,o as j,q as E,l as g,j as a,R as F,ac as q,w as t,Z as Y,s as Z,M as G,_ as H,f as J,a0 as Q,a2 as W,E as m,ar as X,i as b,Y as ee,F as o,as as ae,a1 as te,B as i,p as U,aN as le,aO as oe,m as se,c as re}from"./index-CZU4bJ5v.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                       */import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";function ie(u={}){return k({url:"/api/user/admin/users",method:"get",params:{keyword:u.keyword,role:u.role,page:u.page||1,size:u.size||10}})}function de(u){return k({url:`/api/user/admin/users/${u}/reset-password`,method:"put"})}function pe(u){return k({url:`/api/user/admin/users/${u}`,method:"get"})}const ue={class:"user-management"},ce={class:"header"},me={class:"search-bar"},_e={class:"table-container"},ge={class:"pagination"},fe={key:0,class:"user-detail"},ve={key:0,class:"avatar-section"},he={__name:"UserManagement",setup(u){const y=h(!1),z=h([]),w=h(!1),l=h(null),c=V({keyword:"",role:""}),s=V({page:1,size:10,total:0}),f=async()=>{try{y.value=!0;const n={page:s.page,size:s.size,...c},e=await ie(n);if(e.data.code===0){const _=e.data.data;z.value=_.list,s.total=_.total,s.page=_.pageNum,s.size=_.pageSize}else m.error(e.data.msg||"获取用户列表失败")}catch(n){console.error("获取用户列表失败:",n),m.error("获取用户列表失败")}finally{y.value=!1}},x=()=>{s.page=1,f()},L=()=>{c.keyword="",c.role="",s.page=1,f()},I=async n=>{try{const e=await pe(n.id);e.data.code===0?(l.value=e.data.data,w.value=!0):m.error(e.data.msg||"获取用户详情失败")}catch(e){console.error("获取用户详情失败:",e),m.error("获取用户详情失败")}},M=async n=>{try{await re.confirm(`确定要重置用户 "${n.username}" 的密码吗？重置后密码将变为 "123456"`,"确认重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await de(n.id);e.data.code===0?m.success(e.data.msg||"密码重置成功"):m.error(e.data.msg||"密码重置失败")}catch(e){e!=="cancel"&&(console.error("重置密码失败:",e),m.error("重置密码失败"))}},N=n=>{s.size=n,s.page=1,f()},R=n=>{s.page=n,f()};return j(()=>{f()}),(n,e)=>{const _=q,C=ee,B=Y,v=Z,d=ae,D=te,A=X,O=Q,p=oe,S=le,T=se,$=W,P=H;return b(),E("div",ue,[g("div",ce,[e[7]||(e[7]=g("h2",null,"用户管理",-1)),g("div",me,[a(_,{modelValue:c.keyword,"onUpdate:modelValue":e[0]||(e[0]=r=>c.keyword=r),placeholder:"搜索用户名",style:{width:"200px","margin-right":"10px"},clearable:"",onKeyup:F(x,["enter"])},null,8,["modelValue"]),a(B,{modelValue:c.role,"onUpdate:modelValue":e[1]||(e[1]=r=>c.role=r),placeholder:"选择角色",style:{width:"150px","margin-right":"10px"},clearable:""},{default:t(()=>[a(C,{label:"普通用户",value:"ROLE_USER"}),a(C,{label:"管理员",value:"ROLE_ADMIN"})]),_:1},8,["modelValue"]),a(v,{type:"primary",onClick:x},{default:t(()=>e[5]||(e[5]=[o("搜索")])),_:1}),a(v,{onClick:L},{default:t(()=>e[6]||(e[6]=[o("重置")])),_:1})])]),g("div",_e,[G((b(),J(A,{data:z.value,style:{width:"100%"},stripe:""},{default:t(()=>[a(d,{prop:"id",label:"ID",width:"80"}),a(d,{prop:"username",label:"用户名",width:"120"}),a(d,{prop:"nickname",label:"昵称",width:"120"}),a(d,{prop:"email",label:"邮箱",width:"200"}),a(d,{prop:"phone",label:"手机号",width:"130"}),a(d,{prop:"role",label:"角色",width:"100"},{default:t(({row:r})=>[a(D,{type:r.role==="ROLE_ADMIN"?"danger":"primary"},{default:t(()=>[o(i(r.role==="ROLE_ADMIN"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"gender",label:"性别",width:"80"}),a(d,{prop:"location",label:"地区",width:"100"}),a(d,{prop:"createTime",label:"注册时间",width:"160"}),a(d,{prop:"lastLoginAt",label:"最后登录",width:"160"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:t(({row:r})=>[a(v,{type:"primary",size:"small",onClick:K=>I(r)},{default:t(()=>e[8]||(e[8]=[o(" 详情 ")])),_:2},1032,["onClick"]),a(v,{type:"warning",size:"small",onClick:K=>M(r)},{default:t(()=>e[9]||(e[9]=[o(" 重置密码 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[P,y.value]]),g("div",ge,[a(O,{"current-page":s.page,"onUpdate:currentPage":e[2]||(e[2]=r=>s.page=r),"page-size":s.size,"onUpdate:pageSize":e[3]||(e[3]=r=>s.size=r),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),a($,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=r=>w.value=r),title:"用户详情",width:"600px"},{default:t(()=>[l.value?(b(),E("div",fe,[a(S,{column:2,border:""},{default:t(()=>[a(p,{label:"用户ID"},{default:t(()=>[o(i(l.value.id),1)]),_:1}),a(p,{label:"用户名"},{default:t(()=>[o(i(l.value.username),1)]),_:1}),a(p,{label:"昵称"},{default:t(()=>[o(i(l.value.nickname||"未设置"),1)]),_:1}),a(p,{label:"手机号"},{default:t(()=>[o(i(l.value.phone||"未设置"),1)]),_:1}),a(p,{label:"性别"},{default:t(()=>[o(i(l.value.gender||"未设置"),1)]),_:1}),a(p,{label:"生日"},{default:t(()=>[o(i(l.value.birthday||"未设置"),1)]),_:1}),a(p,{label:"地区"},{default:t(()=>[o(i(l.value.location||"未设置"),1)]),_:1}),a(p,{label:"角色"},{default:t(()=>[a(D,{type:l.value.role==="ROLE_ADMIN"?"danger":"primary"},{default:t(()=>[o(i(l.value.role==="ROLE_ADMIN"?"管理员":"普通用户"),1)]),_:1},8,["type"])]),_:1}),a(p,{label:"注册时间",span:2},{default:t(()=>[o(i(l.value.createdAt),1)]),_:1}),a(p,{label:"最后登录",span:2},{default:t(()=>[o(i(l.value.lastLoginAt||"从未登录"),1)]),_:1}),a(p,{label:"个人简介",span:2},{default:t(()=>[o(i(l.value.bio||"暂无简介"),1)]),_:1})]),_:1}),l.value.avatar?(b(),E("div",ve,[e[10]||(e[10]=g("h4",null,"头像",-1)),a(T,{src:l.value.avatar,style:{width:"100px",height:"100px"},fit:"cover"},null,8,["src"])])):U("",!0)])):U("",!0)]),_:1},8,["modelValue"])])}}},Ae=ne(he,[["__scopeId","data-v-ac60ed49"]]);export{Ae as default};
